<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>대박통신 관리자 시스템</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="login-view" style="height: 100vh; background: linear-gradient(135deg, #4e73df 10%, #224abe 100%); display: flex; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; z-index: 9999;">
        <div class="glass-card p-5 text-center shadow-lg" style="width: 90%; max-width: 400px; border-radius: 20px;">
            <h3 class="fw-bold mb-4 text-primary fs-4"><i class="bi bi-phone-vibrate"></i> 대박통신 관리자 시스템</h3>
            <div id="g_id_onload" data-client_id="98614909172-tj2a973qqgi1l7iukvfnnek0e09bpupl.apps.googleusercontent.com" data-callback="handleCredentialResponse"></div>
            <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline" data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left"></div>
            <div id="login-msg" class="text-danger mt-3 small fw-bold"></div>
        </div>
    </div>

    <div id="main-view" style="display:none;">
        <nav class="navbar navbar-expand-lg sticky-top px-3 bg-white shadow-sm">
            <div class="container-fluid px-0">
                <a class="navbar-brand fw-bold text-primary" onclick="showSection('section-dashboard')" style="cursor:pointer;"><i class="bi bi-grid-fill"></i> 대박통신</a>
                <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto ms-lg-3">
                        <li class="nav-item"><a class="nav-link" onclick="showSection('section-dashboard')">📊 대시보드</a></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">📦 재고 관리</a>
                            <ul class="dropdown-menu shadow-sm border-0">
                                <li><a class="dropdown-item" href="#" onclick="showSection('section-in')">입고 등록</a></li>
                                <li><a class="dropdown-item" href="#" onclick="showSection('section-move')">재고 이동</a></li>
                                <li><a class="dropdown-item text-danger" href="#" onclick="showSection('section-out')">반품 처리</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="showSection('section-stock')">🔍 재고 조회</a></li>
                                <li><a class="dropdown-item" href="#" onclick="showSection('section-history')">📜 이력 조회</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle text-primary" href="#" data-bs-toggle="dropdown">✅ 개통 처리</a>
                            <ul class="dropdown-menu shadow-sm border-0">
                                <li><a class="dropdown-item" href="#" onclick="showOpenSection('무선개통')"><i class="bi bi-phone text-primary"></i> 무선 개통</a></li>
                                <li><a class="dropdown-item" href="#" onclick="showWiredSection()"><i class="bi bi-router text-success"></i> 유선 개통</a></li>
                                <li><a class="dropdown-item" href="#" onclick="showUsedSection()"><i class="bi bi-recycle text-warning"></i> 중고 개통</a></li>
                            </ul>
                        </li>
                        <li class="nav-item"><a class="nav-link" onclick="showSection('section-vendor')">🏢 거래처</a></li>
                    </ul>
                    <div class="d-flex align-items-center mt-3 mt-lg-0">
                        <span class="small me-3 fw-bold text-secondary" id="user-name"></span>
                        <button onclick="logout()" class="btn btn-sm btn-outline-secondary rounded-pill"><i class="bi bi-box-arrow-right"></i> 로그아웃</button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container py-4">

            <div id="section-dashboard" class="section-view active-section">
                <div class="row g-3 mb-4">
                    <div class="col-lg-6">
                        <div class="glass-card stat-card p-4 h-100">
                            <div class="text-xs fw-bold text-primary text-uppercase mb-2">오늘 개통 현황 (전체)</div>
                            <div class="row text-center mt-2">
                                <div class="col-6 border-end">
                                    <div class="small text-muted mb-1">📱 무선</div>
                                    <div class="h3 fw-bold text-dark mb-0" id="dash_today_mobile">-</div>
                                </div>
                                <div class="col-6">
                                    <div class="small text-muted mb-1">📺 유선</div>
                                    <div class="h3 fw-bold text-dark mb-0" id="dash_today_wired">-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="glass-card stat-card month p-4 h-100">
                            <div class="text-xs fw-bold text-success text-uppercase mb-3">이번 달 누적 (지점별)</div>
                            <div id="dash_month_stats" class="d-flex flex-column justify-content-center"></div>
                        </div>
                    </div>
                </div>
                <div class="row g-3">
                    <div class="col-lg-7">
                        <div class="glass-card h-100">
                            <div class="card-header py-3 px-4 bg-white border-bottom d-flex justify-content-between align-items-center">
                                <h6 class="m-0 fw-bold text-primary"><i class="bi bi-broadcast"></i> 실시간 개통 (Today)</h6>
                                <button class="btn btn-sm btn-light border rounded-circle" onclick="loadDashboard()" title="새로고침"><i class="bi bi-arrow-clockwise"></i></button>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                    <table class="table table-hover align-middle mb-0 dash-table">
                                        <thead class="sticky-top border-bottom">
                                            <tr>
                                                <th>지점</th>
                                                <th>유형</th>
                                                <th>고객명</th>
                                                <th>담당매니저</th>
                                                <th>마진</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dash_today_list">
                                            <tr><td colspan="5" class="text-center py-5 text-muted">데이터 로딩 중...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <div class="glass-card h-100">
                            <div class="card-header py-3 px-4 bg-white border-bottom">
                                <h6 class="m-0 fw-bold text-success"><i class="bi bi-trophy"></i> 이달의 직원 실적</h6>
                            </div>
                            <div class="card-body p-4" id="dash_user_rank" style="min-height: 200px;">
                                <div class="text-center py-5 text-muted">로딩 중...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="section-in" class="section-view">
                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-4 text-secondary"><i class="bi bi-box-seam"></i> 입고 등록</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-6"><label class="form-label-sm">거래처</label><select class="form-select form-select-sm" id="in_supplier"></select></div>
                        <div class="col-6"><label class="form-label-sm">지점</label><select class="form-select form-select-sm" id="in_branch"><option value="장지 본점">장지 본점</option><option value="명일 직영점">명일 직영점</option></select></div>
                    </div>
                    <div class="mb-3"><input type="checkbox" id="in_mode_toggle"> <label for="in_mode_toggle" class="small">연속 스캔 모드</label></div>
                    <input type="text" class="form-control form-control-lg text-center fw-bold mb-3 border-primary" id="in_scan" placeholder="바코드 스캔" onkeydown="handleInScan(event)">
                    <div id="in-msg" class="alert py-2 text-center small fw-bold" style="display:none"></div>
                    <div id="in_batch_area" style="display:none;" class="bg-light p-3 rounded border">
                        <div class="d-flex justify-content-between mb-2"><span class="small fw-bold">대기 목록 <span id="in_count" class="badge bg-primary">0</span></span><button class="btn btn-xs btn-outline-danger" onclick="clearInList()">비우기</button></div>
                        <div style="max-height:150px; overflow-y:auto; margin-bottom:10px;"><table class="table table-sm small mb-0"><tbody id="in_tbody"></tbody></table></div>
                        <button class="btn btn-primary w-100 btn-sm fw-bold" onclick="submitInBatch()">일괄 등록하기</button>
                    </div>
                </div>
            </div>

            <div id="section-open" class="section-view">
                <div class="glass-card border-top border-4 border-primary">
                    <div class="p-3 bg-light border-bottom d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold text-primary" id="open_title"><i class="bi bi-phone"></i> 무선 개통</h5>
                        <button class="btn btn-sm btn-outline-secondary" onclick="resetOpenForm()">초기화</button>
                    </div>
                    <div class="p-4">
                        <div id="open_step_1">
                            <div class="text-center p-5 bg-light rounded border border-dashed mb-3">
                                <i class="bi bi-qr-code-scan fs-1 text-muted mb-3 d-block"></i>
                                <label class="text-muted fw-bold mb-3">단말기 일련번호를 입력하세요.</label>
                                <input type="text" class="form-control form-control-lg text-center fs-4 fw-bold mx-auto" style="max-width:300px;" id="open_scan" onkeydown="handleOpenScan(event)" autocomplete="off">
                                <div id="open_spinner" class="mt-3 text-primary small fw-bold" style="display:none;">조회 중...</div>
                            </div>
                        </div>
                        <div id="open_step_2" style="display:none;">
                            <div class="alert alert-primary d-flex justify-content-between align-items-center shadow-sm">
                                <div><i class="bi bi-phone-fill me-2"></i><span id="target_model" class="fw-bold fs-5"></span></div>
                                <span class="badge bg-primary fs-6" id="target_branch"></span>
                            </div>
                            <div class="section-header"><i class="bi bi-person-badge"></i> 기본 정보</div>
                            <div class="row g-2 mb-4">
                                <div class="col-4"><label class="form-label-sm">개통유형</label><select class="form-select form-select-sm" id="f_act_type"></select></div>
                                <div class="col-4"><label class="form-label-sm">약정유형</label><select class="form-select form-select-sm" id="f_cont_type"></select></div>
                                <div class="col-4"><label class="form-label-sm">방문경로<span class="required-star">*</span></label><select class="form-select form-select-sm" id="f_visit" onchange="checkVisitPath()"></select></div>
                                <div class="col-12" id="div_visit_etc" style="display:none;"><input type="text" class="form-control form-control-sm" id="f_visit_etc" placeholder="상세 경로 입력"></div>
                                <div class="col-4"><label class="form-label-sm">고객명<span class="required-star">*</span></label><input type="text" class="form-control form-control-sm" id="f_name"></div>
                                <div class="col-4"><label class="form-label-sm">생년월일</label><input type="text" class="form-control form-control-sm" id="f_birth" placeholder="6자리"></div>
                                <div class="col-4"><label class="form-label-sm">연락처</label><input type="text" class="form-control form-control-sm" id="f_phone"></div>
                                <div class="col-6"><label class="form-label-sm">요금제</label><input type="text" class="form-control form-control-sm" id="f_plan"></div>
                                <div class="col-6"><label class="form-label-sm">변경요금제</label><input type="text" class="form-control form-control-sm" id="f_plan_chg"></div>
                                <div class="col-12"><label class="form-label-sm">부가서비스</label><div id="div_addon_container" class="border rounded p-3 bg-light" style="min-height: 50px;"></div></div>
                                <div class="col-4"><label class="form-label-sm">제휴카드</label><input type="text" class="form-control form-control-sm" id="f_card"></div>
                                <div class="col-4"><label class="form-label-sm">리뷰작성<span class="required-star">*</span></label><select class="form-select form-select-sm" id="f_review"></select></div>
                            </div>
                            <div class="divider"></div>
                            <div class="section-header"><i class="bi bi-calculator"></i> 정책 및 정산</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">개통처</label><input type="text" class="form-control form-control-sm" id="f_avalue" oninput="refreshAddons()"></div>
                                <div class="col-6"><label class="form-label-sm">정책차수</label><input type="text" class="form-control form-control-sm" id="f_policy"></div>
                                <div class="col-6"><label class="form-label-sm">액면/히든</label><input type="number" class="form-control form-control-sm" id="f_inc1"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="f_inc1_m"></div>
                                <div class="col-6"><label class="form-label-sm">추가정책</label><input type="number" class="form-control form-control-sm" id="f_inc2"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="f_inc2_m"></div>
                                <div class="col-6"><label class="form-label-sm">부가정책</label><input type="number" class="form-control form-control-sm" id="f_inc3"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="f_inc3_m"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">차감정책</label><input type="number" class="form-control form-control-sm border-danger-custom" id="f_cost1"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="f_cost1_m"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">프리할인</label><input type="number" class="form-control form-control-sm border-danger-custom" id="f_cost2"></div>
                                <div class="col-6"><label class="form-label-sm">유심</label><select class="form-select form-select-sm" id="f_usim"></select></div>
                            </div>
                            <div class="divider"></div>
                            <div class="section-header"><i class="bi bi-credit-card"></i> 대납 및 지원</div>
                            <div class="row g-2 mb-3">
                                <div class="col-4"><label class="form-label-sm text-danger-custom">대납1</label><input type="number" class="form-control form-control-sm border-danger-custom" id="f_pay1"></div>
                                <div class="col-4"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="f_pay1_m"></select></div>
                                <div class="col-4"><label class="form-label-sm">처리일</label><input type="date" class="form-control form-control-sm" id="f_pay1_d"></div>
                                <div class="col-4"><label class="form-label-sm text-danger-custom">대납2</label><input type="number" class="form-control form-control-sm border-danger-custom" id="f_pay2"></div>
                                <div class="col-4"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="f_pay2_m"></select></div>
                                <div class="col-4"><label class="form-label-sm">처리일</label><input type="date" class="form-control form-control-sm" id="f_pay2_d"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">현금지급</label><input type="number" class="form-control form-control-sm border-danger-custom" id="f_cash"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">페이백</label><input type="number" class="form-control form-control-sm border-danger-custom" id="f_back"></div>
                                <div class="col-4"><label class="form-label-sm">은행명</label><input type="text" class="form-control form-control-sm" id="f_bank"></div>
                                <div class="col-4"><label class="form-label-sm">계좌번호</label><input type="text" class="form-control form-control-sm" id="f_acc"></div>
                                <div class="col-4"><label class="form-label-sm">예금주</label><input type="text" class="form-control form-control-sm" id="f_holder"></div>
                            </div>
                            <div class="divider"></div>
                            <div class="section-header"><i class="bi bi-wallet2"></i> 수납 상세</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">단말기수납1</label><input type="number" class="form-control form-control-sm" id="f_inc4"></div>
                                <div class="col-6"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="f_inc4_m"></select></div>
                                <div class="col-6"><label class="form-label-sm">단말기수납2</label><input type="number" class="form-control form-control-sm" id="f_inc4_2"></div>
                                <div class="col-6"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="f_inc4_2_m"></select></div>
                                <div class="col-6"><label class="form-label-sm">요금수납</label><input type="number" class="form-control form-control-sm" id="f_inc5"></div>
                                <div class="col-6"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="f_inc5_m"></select></div>
                                <div class="col-6"><label class="form-label-sm">중고폰</label><input type="number" class="form-control form-control-sm" id="f_inc6"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="f_inc6_m"></div>
                                <div class="col-12"><label class="form-label-sm">기타 특이사항</label><input type="text" class="form-control form-control-sm" id="f_comment"></div>
                            </div>
                            <div class="mt-4 pb-4">
                                <button type="button" id="btn-mobile-save" class="btn btn-primary w-100 py-3 fw-bold shadow-sm" onclick="submitFullContract(event)">
                                    <i class="bi bi-save-fill"></i> 개통 및 저장 완료
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="section-wired" class="section-view">
                 <div class="glass-card border-top border-4 border-success">
                    <div class="p-3 bg-light border-bottom d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold text-success"><i class="bi bi-router"></i> 유선 개통</h5>
                        <button class="btn btn-sm btn-outline-secondary" onclick="resetWiredForm()">초기화</button>
                    </div>
                    <div class="p-4">
                        <div id="wired_step_1">
                            <div class="bg-light p-4 rounded border">
                                <div class="mb-3"><label class="form-label fw-bold">1. 지점 선택</label><select class="form-select" id="wired_branch"><option value="" selected>선택하세요</option><option value="장지 본점">장지 본점</option><option value="명일 직영점">명일 직영점</option></select></div>
                                <div class="mb-3"><label class="form-label fw-bold">2. 개통처 선택</label><select class="form-select" id="w_pre_avalue"><option value="" selected>선택하세요</option></select></div>
                                <div class="mb-3"><label class="form-label fw-bold">3. 개통유형 선택</label><select class="form-select" id="w_pre_act_type"><option value="" selected>선택하세요</option></select></div>
                                <div class="mb-4"><label class="form-label fw-bold">4. 약정유형 선택</label><select class="form-select" id="w_pre_cont_type"><option value="" selected>선택하세요</option></select></div>
                                <button class="btn btn-success w-100 fw-bold py-2" onclick="startWiredActivation()">다음 단계로 이동</button>
                            </div>
                        </div>
                        <div id="wired_step_2" style="display:none;">
                            <div class="alert alert-success d-flex justify-content-between align-items-center shadow-sm mb-4"><div><i class="bi bi-check-circle-fill me-2"></i><span id="w_target_info" class="fw-bold fs-5"></span></div><span class="badge bg-success fs-6" id="w_target_branch"></span></div>
                            <div class="section-header"><i class="bi bi-person-lines-fill"></i> 기본 정보</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">개통유형</label><input type="text" class="form-control form-control-sm" id="w_act_type" readonly></div>
                                <div class="col-6"><label class="form-label-sm">약정유형</label><input type="text" class="form-control form-control-sm" id="w_cont_type" readonly></div>
                                <div class="col-4"><label class="form-label-sm">방문경로<span class="required-star">*</span></label><select class="form-select form-select-sm" id="w_visit" onchange="checkWiredVisitPath()"></select></div>
                                <div class="col-12" id="w_div_visit_etc" style="display:none;"><input type="text" class="form-control form-control-sm" id="w_visit_etc" placeholder="상세 경로"></div>
                                <div class="col-4"><label class="form-label-sm">고객명<span class="required-star">*</span></label><input type="text" class="form-control form-control-sm" id="w_name"></div>
                                <div class="col-4"><label class="form-label-sm">생년월일</label><input type="text" class="form-control form-control-sm" id="w_birth"></div>
                                <div class="col-4"><label class="form-label-sm">연락처</label><input type="text" class="form-control form-control-sm" id="w_phone"></div>
                                <div class="col-12" id="w_plan_input_area"></div>
                                <div class="col-4"><label class="form-label-sm">제휴카드</label><input type="text" class="form-control form-control-sm" id="w_card"></div>
                                <div class="col-4"><label class="form-label-sm">리뷰작성<span class="required-star">*</span></label><select class="form-select form-select-sm" id="w_review"></select></div>
                            </div>
                            <div class="divider"></div><div class="section-header"><i class="bi bi-calculator"></i> 정책 및 정산</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">개통처</label><input type="text" class="form-control form-control-sm" id="w_avalue"></div>
                                <div class="col-6"><label class="form-label-sm">정책차수</label><input type="text" class="form-control form-control-sm" id="w_policy"></div>
                                <div class="col-6"><label class="form-label-sm">액면/히든</label><input type="number" class="form-control form-control-sm" id="w_inc1"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="w_inc1_m"></div>
                                <div class="col-6"><label class="form-label-sm">추가정책</label><input type="number" class="form-control form-control-sm" id="w_inc2"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="w_inc2_m"></div>
                                <div class="col-6"><label class="form-label-sm">부가정책</label><input type="number" class="form-control form-control-sm" id="w_inc3"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="w_inc3_m"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">차감정책</label><input type="number" class="form-control form-control-sm border-danger-custom" id="w_cost1"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="w_cost1_m"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">프리할인</label><input type="number" class="form-control form-control-sm border-danger-custom" id="w_cost2"></div>
                            </div>
                            <div class="divider"></div><div class="section-header"><i class="bi bi-credit-card"></i> 대납 및 지원</div>
                            <div class="row g-2 mb-3">
                                <div class="col-4"><label class="form-label-sm text-danger-custom">대납1</label><input type="number" class="form-control form-control-sm border-danger-custom" id="w_pay1"></div>
                                <div class="col-4"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="w_pay1_m"></select></div>
                                <div class="col-4"><label class="form-label-sm">처리일</label><input type="date" class="form-control form-control-sm" id="w_pay1_d"></div>
                                <div class="col-4"><label class="form-label-sm text-danger-custom">대납2</label><input type="number" class="form-control form-control-sm border-danger-custom" id="w_pay2"></div>
                                <div class="col-4"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="w_pay2_m"></select></div>
                                <div class="col-4"><label class="form-label-sm">처리일</label><input type="date" class="form-control form-control-sm" id="w_pay2_d"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">현금지급</label><input type="number" class="form-control form-control-sm border-danger-custom" id="w_cash"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">페이백</label><input type="number" class="form-control form-control-sm border-danger-custom" id="w_back"></div>
                                <div class="col-4"><label class="form-label-sm">은행명</label><input type="text" class="form-control form-control-sm" id="w_bank"></div>
                                <div class="col-4"><label class="form-label-sm">계좌번호</label><input type="text" class="form-control form-control-sm" id="w_acc"></div>
                                <div class="col-4"><label class="form-label-sm">예금주</label><input type="text" class="form-control form-control-sm" id="w_holder"></div>
                            </div>
                            <div class="divider"></div><div class="section-header"><i class="bi bi-wallet2"></i> 수납 상세</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">요금수납</label><input type="number" class="form-control form-control-sm" id="w_inc5"></div>
                                <div class="col-6"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="w_inc5_m"></select></div>
                                <div class="col-6"><label class="form-label-sm">상품권/기타</label><input type="number" class="form-control form-control-sm" id="w_inc6"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="w_inc6_m"></div>
                                <div class="col-12"><label class="form-label-sm">기타 특이사항</label><input type="text" class="form-control form-control-sm" id="w_comment"></div>
                            </div>
                            <div class="mt-4 pb-4">
                                <button type="button" class="btn btn-success w-100 py-3 fw-bold shadow-sm" onclick="submitWiredContract(event)">
                                    <i class="bi bi-save-fill"></i> 유선 개통 저장
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="section-used" class="section-view">
                 <div class="glass-card border-top border-4 border-warning">
                    <div class="p-3 bg-light border-bottom d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold text-warning"><i class="bi bi-recycle"></i> 중고 개통</h5>
                        <button class="btn btn-sm btn-outline-secondary" onclick="resetUsedForm()">초기화</button>
                    </div>
                    <div class="p-4">
                        <div id="used_step_1">
                            <div class="bg-light p-4 rounded border">
                                <div class="mb-3"><label class="form-label fw-bold">1. 지점 선택</label><select class="form-select" id="u_branch"><option value="" selected>선택하세요</option><option value="장지 본점">장지 본점</option><option value="명일 직영점">명일 직영점</option></select></div>
                                <div class="mb-3"><label class="form-label fw-bold">2. 개통처 선택</label><select class="form-select" id="u_pre_avalue"><option value="" selected>선택하세요</option></select></div>
                                <div class="mb-3"><label class="form-label fw-bold">3. 개통유형 선택</label><select class="form-select" id="u_pre_act_type"><option value="" selected>선택하세요</option></select></div>
                                <div class="mb-4"><label class="form-label fw-bold">4. 약정유형 선택</label><select class="form-select" id="u_pre_cont_type"><option value="" selected>선택하세요</option></select></div>
                                <button class="btn btn-warning text-white w-100 fw-bold py-2" onclick="startUsedActivation()">다음 단계로 이동</button>
                            </div>
                        </div>
                        <div id="used_step_2" style="display:none;">
                            <div class="alert alert-warning d-flex justify-content-between align-items-center shadow-sm mb-4"><div><i class="bi bi-recycle me-2"></i><span id="u_target_info" class="fw-bold fs-5"></span></div><span class="badge bg-warning text-dark fs-6" id="u_target_branch"></span></div>
                            <div class="section-header"><i class="bi bi-person-lines-fill"></i> 기본 정보</div>
                            <div class="row g-2 mb-3">
                                <div class="col-4"><label class="form-label-sm">개통유형</label><input type="text" class="form-control form-control-sm" id="u_act_type" readonly></div>
                                <div class="col-4"><label class="form-label-sm">약정유형</label><input type="text" class="form-control form-control-sm" id="u_cont_type" readonly></div>
                                <div class="col-4"><label class="form-label-sm">방문경로<span class="required-star">*</span></label><select class="form-select form-select-sm" id="u_visit" onchange="checkUsedVisitPath()"></select></div>
                                <div class="col-12" id="u_div_visit_etc" style="display:none;"><input type="text" class="form-control form-control-sm" id="u_visit_etc" placeholder="상세 경로"></div>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-4"><label class="form-label-sm">고객명<span class="required-star">*</span></label><input type="text" class="form-control form-control-sm" id="u_name"></div>
                                <div class="col-4"><label class="form-label-sm">생년월일</label><input type="text" class="form-control form-control-sm" id="u_birth"></div>
                                <div class="col-4"><label class="form-label-sm">연락처</label><input type="text" class="form-control form-control-sm" id="u_phone"></div>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">기기모델명</label><input type="text" class="form-control form-control-sm" id="u_model"></div>
                                <div class="col-6"><label class="form-label-sm">일련번호</label><input type="text" class="form-control form-control-sm" id="u_serial"></div>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">요금제</label><input type="text" class="form-control form-control-sm" id="u_plan"></div>
                                <div class="col-6"><label class="form-label-sm">변경요금제</label><input type="text" class="form-control form-control-sm" id="u_plan_chg"></div>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-12"><label class="form-label-sm">부가서비스</label><div id="u_div_addon_container" class="border rounded p-2 bg-light" style="min-height: 40px;"></div></div>
                                <div class="col-4"><label class="form-label-sm">제휴카드</label><input type="text" class="form-control form-control-sm" id="u_card"></div>
                                <div class="col-4"><label class="form-label-sm">리뷰작성<span class="required-star">*</span></label><select class="form-select form-select-sm" id="u_review"></select></div>
                            </div>
                            <div class="divider"></div><div class="section-header"><i class="bi bi-calculator"></i> 정책 및 정산</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">개통처</label><input type="text" class="form-control form-control-sm" id="u_avalue" oninput="refreshUsedAddons()"></div>
                                <div class="col-6"><label class="form-label-sm">정책차수</label><input type="text" class="form-control form-control-sm" id="u_policy"></div>
                                <div class="col-6"><label class="form-label-sm">액면/히든</label><input type="number" class="form-control form-control-sm" id="u_inc1"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="u_inc1_m"></div>
                                <div class="col-6"><label class="form-label-sm">추가정책</label><input type="number" class="form-control form-control-sm" id="u_inc2"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="u_inc2_m"></div>
                                <div class="col-6"><label class="form-label-sm">부가정책</label><input type="number" class="form-control form-control-sm" id="u_inc3"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="u_inc3_m"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">차감정책</label><input type="number" class="form-control form-control-sm border-danger-custom" id="u_cost1"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="u_cost1_m"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">프리할인</label><input type="number" class="form-control form-control-sm border-danger-custom" id="u_cost2"></div>
                                <div class="col-6"><label class="form-label-sm">유심</label><select class="form-select form-select-sm" id="u_usim"><option value="" selected>선택</option></select></div>
                            </div>
                            <div class="divider"></div><div class="section-header"><i class="bi bi-credit-card"></i> 대납 및 지원</div>
                            <div class="row g-2 mb-3">
                                <div class="col-4"><label class="form-label-sm text-danger-custom">대납1</label><input type="number" class="form-control form-control-sm border-danger-custom" id="u_pay1"></div>
                                <div class="col-4"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="u_pay1_m"></select></div>
                                <div class="col-4"><label class="form-label-sm">처리일</label><input type="date" class="form-control form-control-sm" id="u_pay1_d"></div>
                                <div class="col-4"><label class="form-label-sm text-danger-custom">대납2</label><input type="number" class="form-control form-control-sm border-danger-custom" id="u_pay2"></div>
                                <div class="col-4"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="u_pay2_m"></select></div>
                                <div class="col-4"><label class="form-label-sm">처리일</label><input type="date" class="form-control form-control-sm" id="u_pay2_d"></div>
                            </div>
                            <div class="divider"></div><div class="section-header"><i class="bi bi-wallet2"></i> 수납 상세</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">요금수납</label><input type="number" class="form-control form-control-sm" id="u_inc5"></div>
                                <div class="col-6"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="u_inc5_m"></select></div>
                                <div class="col-6"><label class="form-label-sm">중고폰</label><input type="number" class="form-control form-control-sm" id="u_inc6"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="u_inc6_m"></div>
                                <div class="col-12"><label class="form-label-sm">기타 특이사항</label><input type="text" class="form-control form-control-sm" id="u_comment"></div>
                            </div>
                            <div class="mt-4 pb-4">
                                <button type="button" class="btn btn-warning w-100 py-3 fw-bold text-white shadow-sm" onclick="submitUsedContract(event)">
                                    <i class="bi bi-save-fill"></i> 중고 개통 저장
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="section-stock" class="section-view">
                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-3"><i class="bi bi-search"></i> 재고 조회 (보유분)</h5>
                    <div class="row g-2 align-items-center mb-3">
                        <div class="col-4"><select class="form-select fw-bold" id="search_criteria" onchange="updateSearchUI()"><option value="supplier">거래처별</option><option value="branch">지점별</option><option value="model">모델별</option><option value="serial">일련번호/바코드</option></select></div>
                        <div class="col-8" id="search_input_area"><select class="form-select" id="search_value_supplier"></select></div>
                    </div>
                    <button class="btn btn-primary w-100 fw-bold rounded-3 mb-3" onclick="searchStock()">조회하기</button>
                    <div id="stock_result"></div>
                </div>
            </div>

            <div id="section-history" class="section-view">
                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-3"><i class="bi bi-clock-history"></i> 이력 조회 (로그)</h5>
                    <div class="input-group mb-3"><input type="text" class="form-control" id="hist_keyword" placeholder="일련번호 또는 바코드 (정확히 입력)" onkeydown="if(event.key==='Enter') searchHistory()"><button class="btn btn-outline-secondary" onclick="searchHistory()">검색</button></div>
                    <div id="hist_result"></div>
                </div>
            </div>

            <div id="section-move" class="section-view">
                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-4 text-primary">재고 이동</h5>
                    <select class="form-select bg-light fw-bold py-3 mb-3" id="move_to_branch"><option value="명일 직영점">👉 명일 직영점으로 보냄</option><option value="장지 본점">👉 장지 본점으로 보냄</option></select>
                    <div class="scan-wrapper my-4"><input type="text" class="form-control scan-input" id="move_scan" placeholder="바코드 또는 일련번호" onkeydown="handleMoveScan(event)" autocomplete="off"></div>
                    <div id="move-msg" class="alert py-2 text-center small fw-bold rounded-3" style="display:none"></div>
                </div>
            </div>

            <div id="section-out" class="section-view">
                <div class="glass-card p-4 border-top border-4 border-danger">
                    <h5 class="fw-bold mb-4 text-danger">반품 처리</h5>
                    <div class="form-floating mb-3"><input type="text" class="form-control" id="out_note" placeholder="사유"><label>반품 사유 / 메모 (필수)</label></div>
                    <div class="scan-wrapper bg-danger bg-opacity-75 my-4" style="background-color: #d63031;"><input type="text" class="form-control scan-input border-danger" id="out_scan" placeholder="바코드 또는 일련번호" onkeydown="handleOutScan(event)" autocomplete="off"></div>
                    <div id="out-msg" class="alert py-2 text-center small fw-bold rounded-3" style="display:none"></div>
                </div>
            </div>
            
            <div id="section-vendor" class="section-view">
                 <div class="glass-card p-4">
                    <h5 class="fw-bold mb-3">거래처 등록</h5>
                    <div class="row g-2 mb-3">
                        <div class="col-12"><input type="text" class="form-control enter-trigger" id="v_name" placeholder="거래처명 (필수)"></div>
                        <div class="col-6"><input type="text" class="form-control enter-trigger" id="v_sales" placeholder="영업사원"></div>
                        <div class="col-6"><input type="text" class="form-control enter-trigger" id="v_phone" placeholder="연락처"></div>
                        <div class="col-12"><input type="text" class="form-control enter-trigger" id="v_office" placeholder="개통실 전화번호"></div>
                    </div>
                    <button class="btn btn-secondary w-100 fw-bold rounded-3" onclick="addVendor()">등록하기</button>
                </div>
                <div class="glass-card p-0">
                    <div class="p-3 border-bottom bg-light"><h6 class="mb-0 fw-bold">등록된 거래처</h6></div>
                    <div id="vendor_list_ui" class="list-group list-group-flush">
                        </div>
                </div>
            </div>

        </div>
    </div>

    <script src="script.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
