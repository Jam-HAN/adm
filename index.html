<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>대박통신 관리자 시스템</title>
    <link rel="icon" type="image/png" href="./favicon.png?v=1">
    <link rel="apple-touch-icon" href="./favicon.png?v=1">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .dash-table { table-layout: fixed !important; width: 100% !important; }
        .dash-table th, .dash-table td {
            width: 20% !important;
            text-align: center !important;
            vertical-align: middle !important;
            padding: 8px 4px !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
        }
        #vendor_list_ui .list-group-item { display: block; }
        #vendor_list_ui .small { display: block !important; color: #6c757d !important; font-size: 0.85em; margin-top: 4px; }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

    <div id="login-view" style="height: 100vh; background: linear-gradient(135deg, #4e73df 10%, #224abe 100%); display: flex; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; z-index: 9999;">
        <div class="p-5 text-center shadow-lg rounded-4 bg-white" style="width: 90%; max-width: 400px;">
            <h3 class="fw-bold mb-4 text-primary fs-4"><i class="bi bi-phone-vibrate"></i> 대박통신 관리자 시스템</h3>
            <div id="g_id_onload" data-client_id="98614909172-tj2a973qqgi1l7iukvfnnek0e09bpupl.apps.googleusercontent.com" data-callback="handleCredentialResponse"></div>
            <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline" data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left"></div>
            <div id="login-msg" class="text-danger mt-3 small fw-bold"></div>
        </div>
    </div>

    <div id="main-view" style="display:none;">
        <nav class="navbar navbar-expand-lg sticky-top px-3 bg-white shadow-sm d-none d-lg-block">
            <div class="container-fluid px-0">
                <a class="navbar-brand fw-bold text-primary" onclick="showSection('section-dashboard')" style="cursor:pointer;"><i class="bi bi-grid-fill"></i> 대박통신</a>
                <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto ms-lg-3">
                        <li class="nav-item"><a class="nav-link" onclick="showSection('section-dashboard')">📊 대시보드</a></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">📦 재고 관리</a>
                            <ul class="dropdown-menu shadow-sm border-0">
                                <li><a class="dropdown-item" href="#" onclick="showSection('section-in')">입고 등록</a></li>
                                <li><a class="dropdown-item" href="#" onclick="showSection('section-move')">재고 이동</a></li>
                                <li><a class="dropdown-item text-danger" href="#" onclick="showSection('section-out')">반품 처리</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="showSection('section-stock')">🔍 재고 조회</a></li>
                                <li><a class="dropdown-item" href="#" onclick="showSection('section-history')">📜 이력 조회</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle text-primary" href="#" data-bs-toggle="dropdown">✅ 개통 처리</a>
                            <ul class="dropdown-menu shadow-sm border-0">
                                <li><a class="dropdown-item" href="#" onclick="showOpenSection('무선개통')"><i class="bi bi-phone text-primary"></i> 무선 개통</a></li>
                                <li><a class="dropdown-item" href="#" onclick="showWiredSection()"><i class="bi bi-router text-success"></i> 유선 개통</a></li>
                                <li><a class="dropdown-item" href="#" onclick="showUsedSection()"><i class="bi bi-recycle text-warning"></i> 중고 개통</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">📂 개통 관리</a>
                            <ul class="dropdown-menu shadow-sm border-0">
                                <li>
                                    <a class="dropdown-item" href="#" onclick="showSection('section-search-all')">
                                        <i class="bi bi-card-list"></i> 개통 조회
                                    </a>
                                </li>

                                <li>
                                    <a class="dropdown-item" href="#" onclick="showSection('section-return-usedphone')">
                                        <i class="bi bi-phone text-primary"></i> 중고폰 반납
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="#" onclick="showSection('section-receive-gift')">
                                        <i class="bi bi-gift text-danger"></i> 상품권 수령
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">💰 정산 관리</a>
                            <ul class="dropdown-menu shadow-sm border-0">
                                <li id="menu_period_item"><a class="dropdown-item" href="#" onclick="showSection('section-settlement-period')">📅 기간별 집계</a></li>
                                <li><a class="dropdown-item" href="#" onclick="showSection('section-settlement-staff')">👥 직원별 집계</a></li>
                            </ul>
                        </li>
                        
                        <li class="nav-item"><a class="nav-link" onclick="showSection('section-vendor')">🏢 거래처</a></li>
                    </ul>
                    <div class="d-flex align-items-center mt-3 mt-lg-0">
                        <span class="small me-3 fw-bold text-secondary" id="user-name"></span>
                        <button onclick="logout()" class="btn btn-sm btn-outline-secondary rounded-pill"><i class="bi bi-box-arrow-right"></i> 로그아웃</button>
                    </div>
                </div>
            </div>
        </nav>

        <nav class="navbar sticky-top px-3 d-lg-none glass-header">
            <div class="container-fluid px-0 d-flex justify-content-between align-items-center">
                <a class="navbar-brand fw-bold text-primary fs-5" onclick="showSection('section-dashboard')">
                    <i class="bi bi-grid-fill"></i> 대박통신
                </a>
                <button onclick="logout()" class="btn btn-sm btn-light border-0 rounded-circle text-secondary">
                    <i class="bi bi-box-arrow-right fs-5"></i>
                </button>
            </div>
        </nav>

        <div class="container py-4">

            <div id="section-dashboard" class="section-view active-section">
                <div class="row g-3 mb-4">
                    <div class="col-lg-6">
                        <div class="glass-card stat-card p-4 h-100">
                            <div class="text-xs fw-bold text-primary text-uppercase mb-2">오늘 개통 현황 (전체)</div>
                            <div class="row text-center mt-2">
                                <div class="col-6 border-end">
                                    <div class="small text-muted mb-1">📱 무선</div>
                                    <div class="h3 fw-bold text-dark mb-0" id="dash_today_mobile">-</div>
                                </div>
                                <div class="col-6">
                                    <div class="small text-muted mb-1">📺 유선</div>
                                    <div class="h3 fw-bold text-dark mb-0" id="dash_today_wired">-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="glass-card stat-card month p-4 h-100">
                            <div class="text-xs fw-bold text-success text-uppercase mb-3">이번 달 누적 (지점별)</div>
                            <div id="dash_month_stats" class="d-flex flex-column justify-content-center"></div>
                        </div>
                    </div>
                </div>
                <div class="row g-3">
                    <div class="col-lg-6">
                        <div class="glass-card h-100">
                            <div class="card-header py-3 px-4 bg-white border-bottom d-flex justify-content-between align-items-center">
                                <h6 class="m-0 fw-bold text-primary"><i class="bi bi-broadcast"></i> 실시간 개통 (Today)</h6>
                                <button class="btn btn-sm btn-light border rounded-circle" onclick="loadDashboard()" title="새로고침"><i class="bi bi-arrow-clockwise"></i></button>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                    <table class="table table-hover align-middle mb-0 dash-table">
                                        <thead class="sticky-top border-bottom">
                                            <tr>
                                                <th>지점</th>
                                                <th>유형</th>
                                                <th>고객명</th>
                                                <th>담당매니저</th>
                                                <th>마진</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dash_today_list">
                                            <tr><td colspan="5" class="text-center py-5 text-muted">데이터 로딩 중...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="glass-card h-100">
                            <div class="card-header py-3 px-4 bg-white border-bottom">
                                <h6 class="m-0 fw-bold text-success"><i class="bi bi-trophy"></i> 이달의 실적 (매니저별)</h6>
                            </div>
                            <div class="card-body p-0" id="dash_user_rank" style="min-height: 200px; overflow-y: auto;">
                                <div class="text-center py-5 text-muted">데이터 로딩 중...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="section-in" class="section-view">
                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-4 text-secondary"><i class="bi bi-box-seam"></i> 입고 등록</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-6"><label class="form-label-sm">거래처</label><select class="form-select form-select-sm" id="in_supplier"></select></div>
                        <div class="col-6"><label class="form-label-sm">지점</label><select class="form-select form-select-sm" id="in_branch"><option value="장지 본점">장지 본점</option><option value="명일 직영점">명일 직영점</option></select></div>
                    </div>
                    <div class="mb-3"><input type="checkbox" id="in_mode_toggle"> <label for="in_mode_toggle" class="small">연속 스캔 모드</label></div>
                    <input type="text" class="form-control form-control-lg text-center fw-bold mb-3 border-primary" id="in_scan" placeholder="바코드 스캔" onkeydown="handleInScan(event)">
                    <div id="in-msg" class="alert py-2 text-center small fw-bold" style="display:none"></div>
                    <div id="in_batch_area" style="display:none;" class="bg-light p-3 rounded border">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="small fw-bold">대기 목록 <span id="in_count" class="badge bg-primary rounded-pill ms-1">0</span></span>
                            <button class="btn btn-xs btn-outline-danger" onclick="clearInList()">비우기</button>
                        </div>

                        <div class="d-flex text-center small fw-bold text-muted border-bottom pb-2 mb-2 px-2">
                            <div style="width: 25%;">거래처</div>
                            <div style="width: 25%;">모델명</div>
                            <div style="width: 15%;">색상</div>
                            <div style="width: 25%;">일련번호</div>
                            <div style="width: 10%;"></div>
                        </div>

                        <div id="in_tbody" class="mt-2" style="max-height: 250px; overflow-y: auto;"></div>

                        <button class="btn btn-primary w-100 btn-sm fw-bold mt-3 shadow-sm" onclick="submitInBatch()">
                            <i class="bi bi-upload"></i> 일괄 등록하기
                        </button>
                    </div>
                </div>
            </div>

            <div id="section-open" class="section-view">
                <div class="glass-card border-top border-4 border-primary">
                    <div class="p-3 bg-light border-bottom d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold text-primary" id="open_title"><i class="bi bi-phone"></i> 무선 개통</h5>
                        <button class="btn btn-sm btn-outline-secondary" onclick="resetOpenForm()">초기화</button>
                    </div>
                    <div class="p-4">
                        <div id="open_step_1">
                            <div class="text-center p-5 bg-light rounded border border-dashed mb-3">
                                <i class="bi bi-qr-code-scan fs-1 text-muted mb-3 d-block"></i>
                                <label class="text-muted fw-bold mb-3">단말기 일련번호를 입력하세요.</label>
                                <input type="text" class="form-control form-control-lg text-center fs-4 fw-bold mx-auto" style="max-width:300px;" id="open_scan" onkeydown="handleOpenScan(event)" autocomplete="off">
                                <div id="open_spinner" class="mt-3 text-primary small fw-bold" style="display:none;">조회 중...</div>
                            </div>
                        </div>
                        <div id="open_step_2" style="display:none;">
                            <div class="alert alert-primary d-flex justify-content-between align-items-center shadow-sm">
                                <div>
                                    <i class="bi bi-phone-fill me-2"></i>
                                    <span id="target_model" class="fw-bold fs-5"></span>
                                    <span class="fw-bold fs-5"> : </span>
                                    <span id="target_serial" class="fw-bold fs-5"></span>
                                </div>
                                <span class="badge bg-primary fs-6" id="target_branch"></span>
                            </div>
                            <div class="section-header"><i class="bi bi-person-badge"></i> 기본 정보</div>
                            <div class="row g-2 mb-4">
                                <div class="col-4"><label class="form-label-sm">개통유형</label><select class="form-select form-select-sm" id="f_act_type"></select></div>
                                <div class="col-4"><label class="form-label-sm">약정유형</label><select class="form-select form-select-sm" id="f_cont_type"></select></div>
                                <div class="col-4"><label class="form-label-sm">방문경로<span class="required-star">*</span></label><select class="form-select form-select-sm" id="f_visit" onchange="checkVisitPath()"></select></div>
                                <div class="col-12" id="div_visit_etc" style="display:none;"><input type="text" class="form-control form-control-sm" id="f_visit_etc" placeholder="상세 경로 입력"></div>
                                <div class="col-4"><label class="form-label-sm">고객명<span class="required-star">*</span></label><input type="text" class="form-control form-control-sm" id="f_name"></div>
                                <div class="col-4"><label class="form-label-sm">생년월일</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="f_birth" placeholder="6자리"></div>
                                <div class="col-4"><label class="form-label-sm">연락처</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="f_phone"></div>
                                <div class="col-6"><label class="form-label-sm">요금제</label><input type="text" class="form-control form-control-sm" id="f_plan"></div>
                                <div class="col-6"><label class="form-label-sm">변경요금제</label><input type="text" class="form-control form-control-sm" id="f_plan_chg"></div>
                                <div class="col-12"><label class="form-label-sm">부가서비스</label><div id="div_addon_container" class="border rounded p-3 bg-light" style="min-height: 50px;"></div></div>
                                <div class="col-4"><label class="form-label-sm">제휴카드</label><input type="text" class="form-control form-control-sm" id="f_card"></div>
                                <div class="col-4"><label class="form-label-sm">리뷰작성<span class="required-star">*</span></label><select class="form-select form-select-sm" id="f_review"></select></div>
                            </div>
                            <div class="divider"></div>
                            <div class="section-header"><i class="bi bi-calculator"></i> 정책 및 정산</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">개통처</label><input type="text" class="form-control form-control-sm" id="f_avalue" oninput="refreshAddons()"></div>
                                <div class="col-6"><label class="form-label-sm">정책차수</label><input type="text" class="form-control form-control-sm" id="f_policy"></div>
                                <div class="col-6"><label class="form-label-sm">액면/히든</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="f_inc1"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="f_inc1_m"></div>
                                <div class="col-6"><label class="form-label-sm">추가정책</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="f_inc2"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="f_inc2_m"></div>
                                <div class="col-6"><label class="form-label-sm">부가정책</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="f_inc3"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="f_inc3_m"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">차감정책</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="f_cost1"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="f_cost1_m"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">프리할인</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="f_cost2"></div>
                                <div class="col-6"><label class="form-label-sm">유심</label><select class="form-select form-select-sm" id="f_usim"></select></div>
                            </div>
                            <div class="divider"></div>
                            <div class="section-header"><i class="bi bi-credit-card"></i> 대납 및 지원</div>
                            <div class="row g-2 mb-3">
                                <div class="col-4"><label class="form-label-sm text-danger-custom">대납1</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="f_pay1"></div>
                                <div class="col-4"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="f_pay1_m"></select></div>
                                <div class="col-4"><label class="form-label-sm">처리일</label><input type="date" class="form-control form-control-sm" id="f_pay1_d"></div>
                                <div class="col-4"><label class="form-label-sm text-danger-custom">대납2</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="f_pay2"></div>
                                <div class="col-4"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="f_pay2_m"></select></div>
                                <div class="col-4"><label class="form-label-sm">처리일</label><input type="date" class="form-control form-control-sm" id="f_pay2_d"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">현금지급</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="f_cash"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">페이백</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="f_back"></div>
                                <div class="col-4"><label class="form-label-sm">은행명</label><input type="text" class="form-control form-control-sm" id="f_bank"></div>
                                <div class="col-4"><label class="form-label-sm">계좌번호</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="f_acc"></div>
                                <div class="col-4"><label class="form-label-sm">예금주</label><input type="text" class="form-control form-control-sm" id="f_holder"></div>
                            </div>
                            <div class="divider"></div>
                            <div class="section-header"><i class="bi bi-wallet2"></i> 수납 상세</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">단말기수납1</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="f_inc4"></div>
                                <div class="col-6"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="f_inc4_m"></select></div>
                                <div class="col-6"><label class="form-label-sm">단말기수납2</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="f_inc4_2"></div>
                                <div class="col-6"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="f_inc4_2_m"></select></div>
                                <div class="col-6"><label class="form-label-sm">요금수납</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="f_inc5"></div>
                                <div class="col-6"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="f_inc5_m"></select></div>
                                <div class="col-6"><label class="form-label-sm">중고폰</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="f_inc6"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="f_inc6_m"></div>
                                <div class="col-12"><label class="form-label-sm">기타 특이사항</label><input type="text" class="form-control form-control-sm" id="f_comment"></div>
                            </div>
                            <div class="mt-4 pb-4">
                                <button type="button" id="btn-mobile-save" class="btn btn-primary w-100 py-3 fw-bold shadow-sm" onclick="submitFullContract(event)">
                                    <i class="bi bi-save-fill"></i> 개통 및 저장 완료
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="section-wired" class="section-view">
                 <div class="glass-card border-top border-4 border-success">
                    <div class="p-3 bg-light border-bottom d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold text-success"><i class="bi bi-router"></i> 유선 개통</h5>
                        <button class="btn btn-sm btn-outline-secondary" onclick="resetWiredForm()">초기화</button>
                    </div>
                    <div class="p-4">
                        <div id="wired_step_1">
                            <div class="bg-light p-4 rounded border">
                                <div class="mb-3"><label class="form-label fw-bold">1. 지점 선택</label><select class="form-select" id="wired_branch"><option value="" selected>선택하세요</option><option value="장지 본점">장지 본점</option><option value="명일 직영점">명일 직영점</option></select></div>
                                <div class="mb-3"><label class="form-label fw-bold">2. 개통처 선택</label><select class="form-select" id="w_pre_avalue"><option value="" selected>선택하세요</option></select></div>
                                <div class="mb-3"><label class="form-label fw-bold">3. 개통유형 선택</label><select class="form-select" id="w_pre_act_type"><option value="" selected>선택하세요</option></select></div>
                                <div class="mb-4"><label class="form-label fw-bold">4. 약정유형 선택</label><select class="form-select" id="w_pre_cont_type"><option value="" selected>선택하세요</option></select></div>
                                <button class="btn btn-success w-100 fw-bold py-2" onclick="startWiredActivation()">다음 단계로 이동</button>
                            </div>
                        </div>
                        <div id="wired_step_2" style="display:none;">
                            <div class="alert alert-success d-flex justify-content-between align-items-center shadow-sm mb-4"><div><i class="bi bi-check-circle-fill me-2"></i><span id="w_target_info" class="fw-bold fs-5"></span></div><span class="badge bg-success fs-6" id="w_target_branch"></span></div>
                            <div class="section-header"><i class="bi bi-person-lines-fill"></i> 기본 정보</div>
                            <div class="row g-2 mb-3">
                                <div class="col-4"><label class="form-label-sm">개통유형</label><input type="text" class="form-control form-control-sm" id="w_act_type" readonly></div>
                                <div class="col-4"><label class="form-label-sm">약정유형</label><input type="text" class="form-control form-control-sm" id="w_cont_type" readonly></div>
                                <div class="col-4"><label class="form-label-sm">방문경로<span class="required-star">*</span></label><select class="form-select form-select-sm" id="w_visit" onchange="checkWiredVisitPath()"></select></div>
                                <div class="col-12" id="w_div_visit_etc" style="display:none;"><input type="text" class="form-control form-control-sm" id="w_visit_etc" placeholder="상세 경로"></div>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-4"><label class="form-label-sm">고객명<span class="required-star">*</span></label><input type="text" class="form-control form-control-sm" id="w_name"></div>
                                <div class="col-4"><label class="form-label-sm">생년월일</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="w_birth"></div>
                                <div class="col-4"><label class="form-label-sm">연락처</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="w_phone"></div>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-12" id="w_plan_input_area"></div>
                                <div class="col-4"><label class="form-label-sm">제휴카드</label><input type="text" class="form-control form-control-sm" id="w_card"></div>
                                <div class="col-4"><label class="form-label-sm">리뷰작성<span class="required-star">*</span></label><select class="form-select form-select-sm" id="w_review"></select></div>
                            </div>
                            <div class="divider"></div><div class="section-header"><i class="bi bi-calculator"></i> 정책 및 정산</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">개통처</label><input type="text" class="form-control form-control-sm" id="w_avalue"></div>
                                <div class="col-6"><label class="form-label-sm">정책차수</label><input type="text" class="form-control form-control-sm" id="w_policy"></div>
                                <div class="col-6"><label class="form-label-sm">액면/히든</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="w_inc1"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="w_inc1_m"></div>
                                <div class="col-6"><label class="form-label-sm">추가정책</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="w_inc2"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="w_inc2_m"></div>
                                <div class="col-6"><label class="form-label-sm">부가정책</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="w_inc3"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="w_inc3_m"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">차감정책</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="w_cost1"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="w_cost1_m"></div>
                            </div>
                            <div class="divider"></div><div class="section-header"><i class="bi bi-credit-card"></i> 대납 및 지원</div>
                            <div class="row g-2 mb-3">
                                <div class="col-4"><label class="form-label-sm text-danger-custom">대납1</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="w_pay1"></div>
                                <div class="col-4"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="w_pay1_m"></select></div>
                                <div class="col-4"><label class="form-label-sm">처리일</label><input type="date" class="form-control form-control-sm" id="w_pay1_d"></div>
                                <div class="col-4"><label class="form-label-sm text-danger-custom">대납2</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="w_pay2"></div>
                                <div class="col-4"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="w_pay2_m"></select></div>
                                <div class="col-4"><label class="form-label-sm">처리일</label><input type="date" class="form-control form-control-sm" id="w_pay2_d"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">현금지급</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="w_cash"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">페이백</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="w_back"></div>
                                <div class="col-4"><label class="form-label-sm">은행명</label><input type="text" class="form-control form-control-sm" id="w_bank"></div>
                                <div class="col-4"><label class="form-label-sm">계좌번호</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="w_acc"></div>
                                <div class="col-4"><label class="form-label-sm">예금주</label><input type="text" class="form-control form-control-sm" id="w_holder"></div>
                            </div>
                            <div class="divider"></div><div class="section-header"><i class="bi bi-wallet2"></i> 수납 상세</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">요금수납</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="w_inc5"></div>
                                <div class="col-6"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="w_inc5_m"></select></div>
                                <div class="col-6"><label class="form-label-sm">상품권/기타</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="w_inc6"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="w_inc6_m"></div>
                                <div class="col-12"><label class="form-label-sm">기타 특이사항</label><input type="text" class="form-control form-control-sm" id="w_comment"></div>
                            </div>
                            <div class="mt-4 pb-4">
                                <button type="button" class="btn btn-success w-100 py-3 fw-bold shadow-sm" onclick="submitWiredContract(event)">
                                    <i class="bi bi-save-fill"></i> 유선 개통 저장
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="section-used" class="section-view">
                 <div class="glass-card border-top border-4 border-warning">
                    <div class="p-3 bg-light border-bottom d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold text-warning"><i class="bi bi-recycle"></i> 중고 개통</h5>
                        <button class="btn btn-sm btn-outline-secondary" onclick="resetUsedForm()">초기화</button>
                    </div>
                    <div class="p-4">
                        <div id="used_step_1">
                            <div class="bg-light p-4 rounded border">
                                <div class="mb-3"><label class="form-label fw-bold">1. 지점 선택</label><select class="form-select" id="u_branch"><option value="" selected>선택하세요</option><option value="장지 본점">장지 본점</option><option value="명일 직영점">명일 직영점</option></select></div>
                                <div class="mb-3"><label class="form-label fw-bold">2. 개통처 선택</label><select class="form-select" id="u_pre_avalue"><option value="" selected>선택하세요</option></select></div>
                                <div class="mb-3"><label class="form-label fw-bold">3. 개통유형 선택</label><select class="form-select" id="u_pre_act_type"><option value="" selected>선택하세요</option></select></div>
                                <div class="mb-4"><label class="form-label fw-bold">4. 약정유형 선택</label><select class="form-select" id="u_pre_cont_type"><option value="" selected>선택하세요</option></select></div>
                                <button class="btn btn-warning text-white w-100 fw-bold py-2" onclick="startUsedActivation()">다음 단계로 이동</button>
                            </div>
                        </div>
                        <div id="used_step_2" style="display:none;">
                            <div class="alert alert-warning d-flex justify-content-between align-items-center shadow-sm mb-4"><div><i class="bi bi-recycle me-2"></i><span id="u_target_info" class="fw-bold fs-5"></span></div><span class="badge bg-warning text-dark fs-6" id="u_target_branch"></span></div>
                            <div class="section-header"><i class="bi bi-person-lines-fill"></i> 기본 정보</div>
                            <div class="row g-2 mb-3">
                                <div class="col-4"><label class="form-label-sm">개통유형</label><input type="text" class="form-control form-control-sm" id="u_act_type" readonly></div>
                                <div class="col-4"><label class="form-label-sm">약정유형</label><input type="text" class="form-control form-control-sm" id="u_cont_type" readonly></div>
                                <div class="col-4"><label class="form-label-sm">방문경로<span class="required-star">*</span></label><select class="form-select form-select-sm" id="u_visit" onchange="checkUsedVisitPath()"></select></div>
                                <div class="col-12" id="u_div_visit_etc" style="display:none;"><input type="text" class="form-control form-control-sm" id="u_visit_etc" placeholder="상세 경로"></div>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-4"><label class="form-label-sm">고객명<span class="required-star">*</span></label><input type="text" class="form-control form-control-sm" id="u_name"></div>
                                <div class="col-4"><label class="form-label-sm">생년월일</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="u_birth"></div>
                                <div class="col-4"><label class="form-label-sm">연락처</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="u_phone"></div>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">기기모델명</label><input type="text" class="form-control form-control-sm" id="u_model"></div>
                                <div class="col-6"><label class="form-label-sm">일련번호</label><input type="text" class="form-control form-control-sm" id="u_serial"></div>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">요금제</label><input type="text" class="form-control form-control-sm" id="u_plan"></div>
                                <div class="col-6"><label class="form-label-sm">변경요금제</label><input type="text" class="form-control form-control-sm" id="u_plan_chg"></div>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-12"><label class="form-label-sm">부가서비스</label><div id="u_div_addon_container" class="border rounded p-2 bg-light" style="min-height: 40px;"></div></div>
                                <div class="col-4"><label class="form-label-sm">제휴카드</label><input type="text" class="form-control form-control-sm" id="u_card"></div>
                                <div class="col-4"><label class="form-label-sm">리뷰작성<span class="required-star">*</span></label><select class="form-select form-select-sm" id="u_review"></select></div>
                            </div>
                            <div class="divider"></div><div class="section-header"><i class="bi bi-calculator"></i> 정책 및 정산</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">개통처</label><input type="text" class="form-control form-control-sm" id="u_avalue" oninput="refreshUsedAddons()"></div>
                                <div class="col-6"><label class="form-label-sm">정책차수</label><input type="text" class="form-control form-control-sm" id="u_policy"></div>
                                <div class="col-6"><label class="form-label-sm">액면/히든</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="u_inc1"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="u_inc1_m"></div>
                                <div class="col-6"><label class="form-label-sm">추가정책</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="u_inc2"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="u_inc2_m"></div>
                                <div class="col-6"><label class="form-label-sm">부가정책</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="u_inc3"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="u_inc3_m"></div>
                                <div class="col-6"><label class="form-label-sm text-danger-custom">차감정책</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="u_cost1"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="u_cost1_m"></div>
                                <div class="col-6"><label class="form-label-sm">유심</label><select class="form-select form-select-sm" id="u_usim"><option value="" selected>선택</option></select></div>
                            </div>
                            <div class="divider"></div><div class="section-header"><i class="bi bi-credit-card"></i> 대납 및 지원</div>
                            <div class="row g-2 mb-3">
                                <div class="col-4"><label class="form-label-sm text-danger-custom">대납1</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="u_pay1"></div>
                                <div class="col-4"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="u_pay1_m"></select></div>
                                <div class="col-4"><label class="form-label-sm">처리일</label><input type="date" class="form-control form-control-sm" id="u_pay1_d"></div>
                                <div class="col-4"><label class="form-label-sm text-danger-custom">대납2</label><input type="number" inputmode="decimal" class="form-control form-control-sm border-danger-custom" id="u_pay2"></div>
                                <div class="col-4"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="u_pay2_m"></select></div>
                                <div class="col-4"><label class="form-label-sm">처리일</label><input type="date" class="form-control form-control-sm" id="u_pay2_d"></div>
                            </div>
                            <div class="divider"></div><div class="section-header"><i class="bi bi-wallet2"></i> 수납 상세</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><label class="form-label-sm">요금수납</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="u_inc5"></div>
                                <div class="col-6"><label class="form-label-sm">방법</label><select class="form-select form-select-sm" id="u_inc5_m"></select></div>
                                <div class="col-6"><label class="form-label-sm">중고폰</label><input type="number" inputmode="decimal" class="form-control form-control-sm" id="u_inc6"></div>
                                <div class="col-6"><label class="form-label-sm">메모</label><input type="text" class="form-control form-control-sm" id="u_inc6_m"></div>
                                <div class="col-12"><label class="form-label-sm">기타 특이사항</label><input type="text" class="form-control form-control-sm" id="u_comment"></div>
                            </div>
                            <div class="mt-4 pb-4">
                                <button type="button" class="btn btn-warning w-100 py-3 fw-bold text-white shadow-sm" onclick="submitUsedContract(event)">
                                    <i class="bi bi-save-fill"></i> 중고 개통 저장
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="section-stock" class="section-view">
                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-3"><i class="bi bi-search"></i> 보유 재고 조회</h5>
                    <div class="row g-2 align-items-center mb-3">
                        <div class="col-4"><select class="form-select fw-bold" id="search_criteria" onchange="updateSearchUI()"><option value="supplier">거래처별</option><option value="branch">지점별</option><option value="model">모델별</option><option value="serial">일련번호/바코드</option></select></div>
                        <div class="col-8" id="search_input_area"><select class="form-select" id="search_value_supplier"></select></div>
                    </div>
                    <button class="btn btn-primary w-100 fw-bold rounded-3 mb-3" onclick="searchStock()">조회하기</button>
                    <div id="stock_result"></div>
                </div>
            </div>

            <div id="section-history" class="section-view">
                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-3"><i class="bi bi-clock-history"></i> 단말기 이력 조회</h5>
                    <div class="input-group mb-3"><input type="text" class="form-control" id="hist_keyword" placeholder="일련번호 또는 바코드 (정확히 입력)" onkeydown="if(event.key==='Enter') searchHistory()"><button class="btn btn-outline-secondary" onclick="searchHistory()">검색</button></div>
                    <div id="hist_result"></div>
                </div>
            </div>

            <div id="section-move" class="section-view">
                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-4 text-primary">재고 이동</h5>
                    <select class="form-select bg-light fw-bold py-3 mb-3" id="move_to_branch"><option value="명일 직영점">👉 명일 직영점으로 보냄</option><option value="장지 본점">👉 장지 본점으로 보냄</option></select>
                    <div class="scan-wrapper my-4"><input type="text" class="form-control scan-input" id="move_scan" placeholder="바코드 또는 일련번호" onkeydown="handleMoveScan(event)" autocomplete="off"></div>
                    <div id="move-msg" class="alert py-2 text-center small fw-bold rounded-3" style="display:none"></div>
                </div>
            </div>

            <div id="section-out" class="section-view">
                <div class="glass-card p-4 border-top border-4 border-danger">
                    <h5 class="fw-bold mb-4 text-danger">반품 처리</h5>
                    <div class="form-floating mb-3"><input type="text" class="form-control" id="out_note" placeholder="사유"><label>반품 사유 / 메모 (필수)</label></div>
                    <div class="scan-wrapper bg-danger bg-opacity-75 my-4" style="background-color: #d63031;"><input type="text" class="form-control scan-input border-danger" id="out_scan" placeholder="바코드 또는 일련번호" onkeydown="handleOutScan(event)" autocomplete="off"></div>
                    <div id="out-msg" class="alert py-2 text-center small fw-bold rounded-3" style="display:none"></div>
                </div>
            </div>
            
            <div id="section-vendor" class="section-view">
                 <div class="glass-card p-4">
                    <h5 class="fw-bold mb-3">거래처 등록</h5>
                    <div class="row g-2 mb-3">
                        <div class="col-4">
                            <select class="form-select enter-trigger" id="v_type">
                                <option value="" selected>통신사</option>
                                <option value="SKT">SKT</option>
                                <option value="KT">KT</option>
                                <option value="LG">LG</option>
                                <option value="기타">기타(일반)</option>
                            </select>
                        </div>
                        <div class="col-8"><input type="text" class="form-control enter-trigger" id="v_name" placeholder="거래처명 (필수)"></div>
                        <div class="col-6"><input type="text" class="form-control enter-trigger" id="v_sales" placeholder="영업사원"></div>
                        <div class="col-6"><input type="text" class="form-control enter-trigger" id="v_phone" placeholder="연락처"></div>
                        <div class="col-12"><input type="text" class="form-control enter-trigger" id="v_office" placeholder="개통실 전화번호"></div>
                    </div>
                    <button class="btn btn-secondary w-100 fw-bold rounded-3" onclick="addVendor()">등록하기</button>
                </div>
                <div class="glass-card p-0">
                    <div class="p-3 border-bottom bg-light"><h6 class="mb-0 fw-bold">등록된 거래처</h6></div>
                    <div id="vendor_list_ui" class="list-group list-group-flush">
                        </div>
                </div>
            </div>

            <div id="section-search-all" class="section-view">
                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-4"><i class="bi bi-card-list"></i> 개통 정보 조회</h5>
                    
                    <div class="row g-2 mb-3">
                        <div class="col-12">
                            <select class="form-select form-select-sm fw-bold text-primary" id="hist_branch_filter">
                                <option value="전체">🏢 전체 지점 보기</option>
                                <option value="장지 본점">장지 본점</option>
                                <option value="명일 직영점">명일 직영점</option>
                            </select>
                        </div>
                        <div class="col-6"><input type="date" class="form-control form-control-sm" id="hist_start_date"></div>
                        <div class="col-6"><input type="date" class="form-control form-control-sm" id="hist_end_date"></div>
                        <div class="col-12">
                            <div class="input-group">
                                <input type="text" class="form-control" id="hist_all_keyword" placeholder="고객명, 연락처" onkeydown="if(event.key==='Enter') searchAllHistory()">
                                <button class="btn btn-outline-secondary" onclick="searchAllHistory()">검색</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="hist_all_result" class="list-group list-group-flush mt-3" style="max-height: 60vh; overflow-y: auto;">
                        <div class="text-center text-muted py-5 small">조회 조건을 입력하고 검색하세요.</div>
                    </div>
                </div>
            </div>

            <div id="section-return-usedphone" class="section-view">
                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-4"><i class="bi bi-phone"></i> 중고폰 반납 등록</h5>
                    
                    <div class="row g-2 mb-3">
                        <div class="col-12">
                            <select id="search_return_branch" class="form-select form-select-sm fw-bold text-primary">
                                <option value="전체">🏢 전체 지점 보기</option>
                                <option value="장지 본점">장지 본점</option>
                                <option value="명일 직영점">명일 직영점</option>
                            </select>
                        </div>
                        
                        <div class="col-6">
                            <input type="date" class="form-control form-control-sm" id="search_return_start">
                        </div>
                        <div class="col-6">
                            <input type="date" class="form-control form-control-sm" id="search_return_end">
                        </div>
                        
                        <div class="col-12">
                            <div class="input-group">
                                <input type="text" class="form-control" id="search_return_keyword" placeholder="고객명, 연락처" onkeydown="if(event.key==='Enter') searchSpecialList('usedphone')">
                                <button class="btn btn-outline-secondary" onclick="searchSpecialList('usedphone')">검색</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="return-usedphone-list" class="mt-3" style="max-height: 60vh; overflow-y: auto;">
                        <div class="text-center text-muted py-5 small">조회 조건을 입력하고 검색하세요.</div>
                    </div>
                </div>
            </div>
            
            <div id="section-receive-gift" class="section-view">
                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-4"><i class="bi bi-gift"></i> 상품권 수령 등록</h5>
                    
                    <div class="row g-2 mb-3">
                        <div class="col-12">
                            <select id="search_gift_branch" class="form-select form-select-sm fw-bold text-primary">
                                <option value="전체">🏢 전체 지점 보기</option>
                                <option value="장지 본점">장지 본점</option>
                                <option value="명일 직영점">명일 직영점</option>
                            </select>
                        </div>
                        
                        <div class="col-6">
                            <input type="date" class="form-control form-control-sm" id="search_gift_start">
                        </div>
                        <div class="col-6">
                            <input type="date" class="form-control form-control-sm" id="search_gift_end">
                        </div>
                        
                        <div class="col-12">
                            <div class="input-group">
                                <input type="text" class="form-control" id="search_gift_keyword" placeholder="고객명, 연락처" onkeydown="if(event.key==='Enter') searchSpecialList('gift')">
                                <button class="btn btn-outline-secondary" onclick="searchSpecialList('gift')">검색</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="receive-gift-list" class="mt-3" style="max-height: 60vh; overflow-y: auto;">
                        <div class="text-center text-muted py-5 small">조회 조건을 입력하고 검색하세요.</div>
                    </div>
                </div>
            </div>
            
            <div class="modal fade" id="modal-special-update" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content border-0 shadow">
                        <div class="modal-header bg-primary text-white">
                            <h5 class="modal-title fw-bold" id="special-modal-title">등록</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body p-4">
                            <input type="hidden" id="sp_sheetName">
                            <input type="hidden" id="sp_rowIndex">
                            <input type="hidden" id="sp_branch">
                            <input type="hidden" id="sp_type"> <div class="alert alert-light border mb-3">
                                <h5 class="fw-bold mb-1" id="sp_customer_name">홍길동</h5>
                                <small class="text-muted" id="sp_customer_info">010-1234-5678 | SKT</small>
                            </div>
            
                            <div class="mb-3">
                                <label class="form-label fw-bold" id="sp_amt_label">정산 금액 (반납 금액)</label>
                                <input type="text" class="form-control form-control-lg fw-bold text-primary" id="sp_amount" placeholder="금액 입력" onkeyup="formatCurrency(this)">
                            </div>

                            <input type="hidden" id="sp_date">
            
                            <div class="mb-3" id="sp_model_group">
                                <label class="form-label fw-bold">반납 모델명</label>
                                <input type="text" class="form-control" id="sp_model_name" placeholder="예: 아이폰13 미니">
                            </div>

                            <div class="mb-3 bg-light p-3 rounded border">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="sp_checkbox" onchange="toggleCheckDate()">
                                    <label class="form-check-label fw-bold text-primary" for="sp_checkbox" id="sp_check_label">
                                        반납/수령 확인
                                    </label>
                                </div>
                            </div>
            
                            <div class="d-grid mt-4">
                                <button type="button" class="btn btn-primary btn-lg fw-bold" onclick="submitSpecialUpdate()">
                                    <i class="bi bi-check-circle"></i> 저장하기
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="section-settlement-period" class="section-view">
                <div class="glass-card p-4 w-100 d-block" style="min-height: 600px;">
                    <h5 class="fw-bold mb-4 text-primary"><i class="bi bi-calendar-check"></i> 기간별 매출 집계</h5>
                    
                    <div class="row g-2 mb-4 align-items-end">
                        <div class="col-4">
                            <label class="small text-muted fw-bold mb-1">보기 방식</label>
                            <select class="form-select fw-bold border-primary text-primary" id="sp_view_type" style="height: 38px;">
                                <option value="branch" selected>🏢 지점별 보기</option>
                                <option value="carrier">📊 거래처별 보기</option>
                            </select>
                        </div>
                        <div class="col-3">
                            <label class="small text-muted fw-bold mb-1">시작일</label>
                            <input type="date" id="sp_start" class="form-control" style="height: 38px;">
                        </div>
                        <div class="col-3">
                            <label class="small text-muted fw-bold mb-1">종료일</label>
                            <input type="date" id="sp_end" class="form-control" style="height: 38px;">
                        </div>
                        <div class="col-2">
                            <button class="btn btn-primary w-100 fw-bold" onclick="loadSettlement('period')" style="height: 38px;">조회</button>
                        </div>
                    </div>
            
                    <div id="sp_result_area" class="table-responsive w-100">
                        <table class="table table-hover align-middle text-center small border w-100" style="table-layout: fixed;">
                            
                            <colgroup>
                                <col style="width: 14%;">
                                <col style="width: 7%;">
                                <col style="width: 7%;">
                                <col style="width: 12%;">
                                <col style="width: 12%;">
                                <col style="width: 12%;">
                                <col style="width: 16%;">
                                <col style="width: 20%;">
                            </colgroup>
            
                            <thead class="table-primary">
                                <tr>
                                    <th rowspan="2" class="align-middle border-bottom-0">구분</th>
                                    <th colspan="2" class="border-bottom-0">건수</th>
                                    <th colspan="3" class="border-bottom-0">매출 상세</th>
                                    <th rowspan="2" class="align-middle border-bottom-0">정산금</th>
                                    <th rowspan="2" class="align-middle border-bottom-0">순수익</th>
                                </tr>
                                <tr>
                                    <th class="bg-white text-muted" style="font-size:0.8rem;">무선</th>
                                    <th class="bg-white text-muted" style="font-size:0.8rem;">유선</th>
                                    <th class="bg-white text-muted" style="font-size:0.8rem;">기기반납</th>
                                    <th class="bg-white text-muted" style="font-size:0.8rem;">중고폰</th>
                                    <th class="bg-white text-muted" style="font-size:0.8rem;">상품권</th>
                                </tr>
                            </thead>
            
                            <tbody id="sp_tbody">
                                <tr style="height: 450px;">
                                    <td colspan="8" class="text-muted align-middle">
                                        <i class="bi bi-search fs-1 d-block mb-3 opacity-25"></i>
                                        기간과 방식을 선택하고 조회하세요.
                                    </td>
                                </tr>
                            </tbody>
                            
                            <tfoot class="table-light fw-bold" id="sp_tfoot"></tfoot>
                        </table>
                    </div>
                </div>
            </div>
            
            <div id="section-settlement-staff" class="section-view">
                <div class="glass-card p-4 w-100 d-block" style="min-height: 600px;">
                    <h5 class="fw-bold mb-4 text-success"><i class="bi bi-people"></i> 직원별 실적 집계</h5>
                    
                    <div class="row g-2 mb-4 align-items-end">
                        <div class="col-5">
                            <label class="small text-muted fw-bold mb-1">시작일</label>
                            <input type="date" id="ss_start" class="form-control" style="height: 38px;">
                        </div>
                        <div class="col-5">
                            <label class="small text-muted fw-bold mb-1">종료일</label>
                            <input type="date" id="ss_end" class="form-control" style="height: 38px;">
                        </div>
                        <div class="col-2">
                            <button class="btn btn-success w-100 fw-bold" onclick="loadSettlement('staff')" style="height: 38px;">조회</button>
                        </div>
                    </div>
            
                    <div class="table-responsive w-100">
                        <table class="table table-hover align-middle text-center small border w-100" style="table-layout: fixed;">
                            <colgroup>
                                <col style="width: 15%;"> 
                                <col style="width: 13%;"> 
                                <col style="width: 13%;"> 
                                <col style="width: 13%;"> 
                                <col style="width: 13%;"> 
                                <col style="width: 13%;"> 
                                <col style="width: 20%;"> 
                            </colgroup>
            
                            <thead class="table-success">
                                <tr>
                                    <th rowspan="2" class="align-middle border-bottom-0">직원명</th>
                                    <th colspan="2" class="border-bottom-0">무선</th>
                                    <th colspan="3" class="border-bottom-0">유선</th>
                                    <th rowspan="2" class="align-middle admin-only border-bottom-0">총 마진</th>
                                </tr>
                                <tr>
                                    <th class="bg-white text-muted text-nowrap" style="font-size:0.75rem;">신규/기변</th>
                                    <th class="bg-white text-muted text-nowrap" style="font-size:0.75rem;">중고</th>
                                    <th class="bg-white text-muted text-nowrap" style="font-size:0.75rem;">동시판매</th>
                                    <th class="bg-white text-muted text-nowrap" style="font-size:0.75rem;">약정갱신</th>
                                    <th class="bg-white text-muted text-nowrap" style="font-size:0.75rem;">단품</th>
                                </tr>
                            </thead>
                            
                            <tbody id="ss_tbody">
                                <tr style="height: 450px;">
                                    <td colspan="7" class="text-muted align-middle">
                                        <i class="bi bi-search fs-1 d-block mb-3 opacity-25"></i>
                                        조회 버튼을 눌러주세요.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <div class="modal fade" id="modal-stock-register" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-primary text-white border-0">
                    <h5 class="modal-title fw-bold" id="modal-register-title"><i class="bi bi-box-seam"></i> 상세 정보 입력</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
    
                    <div class="mb-3" id="area-modal-barcode">
                        <label class="form-label small fw-bold text-muted">바코드</label>
                        <input type="text" class="form-control bg-light" id="reg_modal_barcode" readonly>
                    </div>

                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">일련번호</label>
                        <input type="text" class="form-control bg-light" id="reg_modal_serial" readonly>
                    </div>

                    <div class="alert alert-warning small fw-bold mb-3" id="msg-manual-text">
                        <i class="bi bi-exclamation-triangle"></i> 등록되지 않은 단말기입니다.<br>
                        정보를 입력하면 다음부터는 자동 등록됩니다.
                    </div>

                     <div class="mb-3" id="area-modal-branch" style="display:none;">
                        <label class="form-label small fw-bold text-muted">입고 지점 선택 <span class="text-danger">*</span></label>
                        <select class="form-select fw-bold" id="reg_modal_branch">
                            <option value="">선택하세요</option>
                            <option value="장지 본점">장지 본점</option>
                            <option value="명일 직영점">명일 직영점</option>
                        </select>
                    </div>                   

                    <div class="mb-3" id="area-modal-supplier" style="display:none;">
                        <label class="form-label small fw-bold text-muted">거래처 선택</label>
                        <select class="form-select fw-bold" id="reg_modal_supplier">
                            </select>
                    </div>

                    <div id="area-iphone" style="display:none;">
                        <div class="mb-3">
                            <label class="form-label small fw-bold text-muted">모델명 선택</label>
                            <select class="form-select fw-bold" id="reg_iphone_model" onchange="updateIphoneColors()">
                                <option value="">선택</option>
                            </select>
                        </div>
        
                        <div class="mb-3">
                            <label class="form-label small fw-bold text-muted">용량 선택</label>
                            <select class="form-select fw-bold" id="reg_iphone_storage">
                                <option value="">선택</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label small fw-bold text-muted">색상 선택</label>
                            <select class="form-select fw-bold" id="reg_iphone_color">
                                <option value="">선택</option>
                            </select>
                        </div>
                    </div>

                    <div id="area-manual" style="display:none;">
                        <div class="mb-3">
                            <label class="form-label small fw-bold text-muted">모델명 선택</label>
                            <input type="text" class="form-control fw-bold" id="reg_manual_model" placeholder="예: SM-S931">
                        </div>

                        <div class="mb-3">
                            <label class="form-label small fw-bold text-muted">용량 선택</label>
                            <select class="form-select fw-bold" id="reg_manual_storage">
                                <option value="">선택</option>
                            </select>
                        </div>
        
                        <div class="mb-3">
                            <label class="form-label small fw-bold text-muted">색상 선택</label>
                            <input type="text" class="form-control fw-bold" id="reg_manual_color" placeholder="예: 오닉스블랙">
                        </div>
                    </div>

                    <button type="button" id="btn-stock-submit" class="btn btn-primary w-100 fw-bold py-2 mt-3">입력 완료</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-edit-history" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title fw-bold">✏️ 개통 정보 수정</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <input type="hidden" id="edit_sheet_name">
                    <input type="hidden" id="edit_row_index">
                    <input type="hidden" id="edit_branch_name">
                    
                    <div id="edit_form_container" class="row g-3"></div>
                </div>
                <div class="modal-footer bg-light border-0 justify-content-between">
                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="deleteHistoryItem()">🗑️ 이 내역 삭제</button>
                    <div>
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">닫기</button>
                        <button type="button" class="btn btn-primary fw-bold" onclick="submitEditHistory()">수정사항 저장</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="script.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <nav class="mobile-bottom-nav d-lg-none">
        <a href="#" class="nav-item active" onclick="showSection('section-dashboard'); activeNav(this)">
            <i class="bi bi-speedometer2"></i>
            <span>홈</span>
        </a>
        <a href="#" class="nav-item" onclick="showSection('section-in'); activeNav(this)">
            <i class="bi bi-box-seam"></i>
            <span>입고</span>
        </a>
        <a href="#" class="nav-item center-fab" onclick="toggleFabMenu()">
            <div class="fab-btn"><i class="bi bi-plus-lg"></i></div>
        </a>
        <a href="#" class="nav-item" onclick="toggleSearchMenu();">
            <i class="bi bi-search"></i>
            <span>조회</span>
        </a>
        <a href="#" class="nav-item" onclick="toggleManageMenu()">
            <i class="bi bi-sliders"></i>
            <span>관리</span>
        </a>
    </nav>

    <div id="fab-menu-overlay" class="d-none" style="position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index: 1050;" onclick="closeAllMobileMenus()"></div>
    <div id="fab-menu-container" class="d-none flex-column gap-2" style="position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); z-index: 1060; width: 200px;">
        <button onclick="showOpenSection('무선개통'); toggleFabMenu();" class="btn btn-light shadow-lg fw-bold py-3 text-primary border-0 rounded-4">
            <i class="bi bi-phone me-2"></i> 무선 개통
        </button>
        <button onclick="showWiredSection(); toggleFabMenu();" class="btn btn-light shadow-lg fw-bold py-3 text-success border-0 rounded-4">
            <i class="bi bi-router me-2"></i> 유선 개통
        </button>
        <button onclick="showUsedSection(); toggleFabMenu();" class="btn btn-light shadow-lg fw-bold py-3 text-warning border-0 rounded-4">
            <i class="bi bi-recycle me-2"></i> 중고 개통
        </button>
    </div>

    <div id="search-menu-container" class="d-none flex-column gap-2" style="position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); z-index: 1060; width: 200px;">
        <button onclick="showSection('section-search-all'); initHistoryDates(); toggleSearchMenu();" class="btn btn-light shadow-lg fw-bold py-3 text-dark border-0 rounded-4">
            <i class="bi bi-card-list me-2 text-primary"></i> 개통 조회
        </button>
        <button onclick="showSection('section-stock'); toggleSearchMenu();" class="btn btn-light shadow-lg fw-bold py-3 text-dark border-0 rounded-4">
            <i class="bi bi-search me-2 text-success"></i> 재고 조회
        </button>
    </div>

    <div id="manage-menu-container" class="d-none flex-column gap-2" style="position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); z-index: 1060; width: 220px;">
        <button onclick="showSection('section-return-usedphone'); toggleManageMenu();" class="btn btn-light shadow-lg fw-bold py-3 text-primary border-0 rounded-4">
            <i class="bi bi-phone me-2"></i> 중고폰 반납
        </button>
        <button onclick="showSection('section-receive-gift'); toggleManageMenu();" class="btn btn-light shadow-lg fw-bold py-3 text-danger border-0 rounded-4">
            <i class="bi bi-gift me-2"></i> 상품권 수령
        </button>
        <button onclick="showSection('section-vendor'); toggleManageMenu();" class="btn btn-light shadow-lg fw-bold py-3 text-dark border-0 rounded-4">
            <i class="bi bi-shop me-2"></i> 거래처 관리
        </button>
    </div>

    <script>
        // 하단 탭 활성화 효과 (script.js에 넣어도 되지만 UI 전용이라 여기에 둠)
        function activeNav(el) {
            document.querySelectorAll('.mobile-bottom-nav .nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
        }
    </script>
</body>
</html>
