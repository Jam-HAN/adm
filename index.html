<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DBPhone Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        :root { --primary-bg: #eef2f6; --card-bg: #ffffff; --accent-color: #4e73df; --accent-gradient: linear-gradient(135deg, #4e73df 0%, #224abe 100%); }
        body { background-color: var(--primary-bg); font-family: 'Noto Sans KR', sans-serif; color: #2e384d; }
        .glass-card { background: var(--card-bg); border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); border: none; overflow: hidden; margin-bottom: 20px; }
        #login-view { height: 100vh; background: var(--accent-gradient); display: flex; align-items: center; justify-content: center; }
        .custom-navbar { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .nav-pills .nav-link { color: #8795a1; font-weight: 500; border-radius: 12px; padding: 10px 16px; transition: all 0.2s; }
        .nav-pills .nav-link.active { background-color: var(--accent-color); color: white; box-shadow: 0 4px 10px rgba(78, 115, 223, 0.3); }
        .scan-wrapper { background: #2d3436; border-radius: 16px; padding: 24px; text-align: center; color: white; box-shadow: 0 10px 30px rgba(45, 52, 54, 0.3); }
        .scan-input { background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 12px; color: #00ff9d; text-align: center; font-size: 1.3rem; font-weight: 700; }
        .scan-input:focus { background: rgba(255, 255, 255, 0.15); border-color: #00ff9d; box-shadow: 0 0 15px rgba(0, 255, 157, 0.2); color: #00ff9d; }
        .form-control, .form-select { border-radius: 10px; border: 1px solid #e0e6ed; padding: 12px; }
        .section-view { display: none; }
        .active-section { display: block; animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="login-view">
        <div class="glass-card p-5 text-center" style="width: 90%; max-width: 400px;">
            <h3 class="fw-bold mb-4 text-primary"><i class="bi bi-phone-vibrate"></i> DBPhone ERP</h3>
            <div id="g_id_onload" data-client_id="98614909172-tj2a973qqgi1l7iukvfnnek0e09bpupl.apps.googleusercontent.com" data-callback="handleCredentialResponse"></div>
            <div class="g_id_signin" data-type="standard" data-size="large"></div>
            <div id="login-msg" class="text-danger mt-3 small"></div>
        </div>
    </div>

    <div id="main-view" style="display:none;">
        <nav class="navbar custom-navbar sticky-top px-3 py-3">
            <div class="d-flex align-items-center w-100 justify-content-between">
                <div class="fw-bold fs-5"><i class="bi bi-grid-fill text-primary me-2"></i>ëŒ€ë°•í†µì‹ </div>
                <div>
                    <span class="small text-muted me-2"><strong id="user-name">ê´€ë¦¬ì</strong>ë‹˜</span>
                    <button onclick="logout()" class="btn btn-sm btn-light rounded-pill border"><i class="bi bi-box-arrow-right"></i></button>
                </div>
            </div>
            <div class="w-100 mt-3 overflow-auto">
                <ul class="nav nav-pills flex-nowrap pb-1">
                    <li class="nav-item"><a class="nav-link active" onclick="showSection('section-in')">ğŸ“¦ ì…ê³ </a></li>
                    <li class="nav-item"><a class="nav-link" onclick="showSection('section-move')">ğŸšš ì´ë™</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="showSection('section-out')">â†©ï¸ ë°˜í’ˆ</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="showSection('section-history')">ğŸ“œ ì¡°íšŒ</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="showSection('section-vendor')">ğŸ¢ ê±°ë˜ì²˜</a></li>
                </ul>
            </div>
        </nav>

        <div class="container py-4">
            
            <div id="section-in" class="section-view active-section">
                <div class="glass-card p-4">
                    <div class="row g-3 mb-4">
                        <div class="col-6">
                            <label class="small text-muted fw-bold">ê±°ë˜ì²˜</label>
                            <select class="form-select fw-bold" id="in_supplier"></select>
                        </div>
                        <div class="col-6">
                            <label class="small text-muted fw-bold">ì§€ì </label>
                            <select class="form-select fw-bold" id="in_branch">
                                <option value="ì¥ì§€ ë³¸ì ">ì¥ì§€ ë³¸ì </option>
                                <option value="ëª…ì¼ ì§ì˜ì ">ëª…ì¼ ì§ì˜ì </option>
                            </select>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="fw-bold small text-secondary">ì…ê³  ìŠ¤ìº”</span>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="in_mode_toggle" onchange="toggleInMode()">
                            <label class="form-check-label small fw-bold text-muted" for="in_mode_toggle" id="in_mode_label">ì¼ë°˜</label>
                        </div>
                    </div>
                    <div class="scan-wrapper mb-3">
                        <input type="text" class="form-control scan-input" id="in_scan" placeholder="ë°”ì½”ë“œ ìŠ¤ìº”" onkeydown="handleInScan(event)" autocomplete="off">
                    </div>
                    <div id="in-msg" class="alert py-2 text-center small fw-bold rounded-3" style="display:none"></div>
                    
                    <div id="in_batch_area" style="display:none;">
                        <div class="bg-light rounded-3 p-3 border">
                            <div class="d-flex justify-content-between mb-2">
                                <h6 class="fw-bold">ëŒ€ê¸° ëª©ë¡ <span class="badge bg-primary rounded-pill" id="in_count">0</span></h6>
                                <button class="btn btn-sm text-danger fw-bold" onclick="clearInList()">ë¹„ìš°ê¸°</button>
                            </div>
                            <div style="max-height: 200px; overflow-y: auto;">
                                <table class="table table-sm table-borderless small align-middle"><tbody id="in_tbody"></tbody></table>
                            </div>
                            <button class="btn btn-primary w-100 rounded-3 mt-2 fw-bold" id="btn_in_submit" onclick="submitInBatch()" disabled>ì…ê³  í™•ì •</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="section-move" class="section-view">
                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-4 text-primary">ì¬ê³  ì´ë™</h5>
                    <select class="form-select bg-light fw-bold py-3 mb-3" id="move_to_branch">
                        <option value="ëª…ì¼ ì§ì˜ì ">ğŸ‘‰ ëª…ì¼ ì§ì˜ì ìœ¼ë¡œ</option>
                        <option value="ì¥ì§€ ë³¸ì ">ğŸ‘‰ ì¥ì§€ ë³¸ì ìœ¼ë¡œ</option>
                    </select>
                    <div class="scan-wrapper my-4">
                        <input type="text" class="form-control scan-input" id="move_scan" placeholder="ë°”ì½”ë“œ ë˜ëŠ” ì¼ë ¨ë²ˆí˜¸" onkeydown="handleMoveScan(event)" autocomplete="off">
                    </div>
                    <div id="move-msg" class="alert py-2 text-center small fw-bold rounded-3" style="display:none"></div>
                </div>
            </div>

            <div id="section-out" class="section-view">
                <div class="glass-card p-4 border-top border-4 border-danger">
                    <h5 class="fw-bold mb-4 text-danger">ë°˜í’ˆ ì²˜ë¦¬</h5>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="out_note" placeholder="ì‚¬ìœ ">
                        <label>ë°˜í’ˆ ì‚¬ìœ  / ë©”ëª¨</label>
                    </div>
                    <div class="scan-wrapper bg-danger bg-opacity-75 my-4" style="background-color: #d63031;">
                        <input type="text" class="form-control scan-input border-danger" id="out_scan" placeholder="ë°”ì½”ë“œ ë˜ëŠ” ì¼ë ¨ë²ˆí˜¸" onkeydown="handleOutScan(event)" autocomplete="off">
                    </div>
                    <div id="out-msg" class="alert py-2 text-center small fw-bold rounded-3" style="display:none"></div>
                </div>
            </div>

            <div id="section-history" class="section-view">
                <div class="glass-card p-3 mb-3 sticky-top" style="top: 80px; z-index: 10;">
                    <div class="input-group">
                        <input type="text" class="form-control border-end-0" id="hist_keyword" placeholder="ì¼ë ¨ë²ˆí˜¸/ëª¨ë¸ëª… ê²€ìƒ‰" onkeydown="if(event.key==='Enter') searchHistory()">
                        <button class="btn btn-outline-secondary border-start-0 bg-white" onclick="searchHistory()"><i class="bi bi-search"></i></button>
                    </div>
                </div>
                <div id="hist_result"></div>
            </div>

            <div id="section-vendor" class="section-view">
                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-3">ì‹ ê·œ ë“±ë¡</h5>
                    <div class="row g-2 mb-3">
                        <div class="col-12"><input type="text" class="form-control enter-trigger" id="v_name" placeholder="ê±°ë˜ì²˜ëª… (í•„ìˆ˜)"></div>
                        <div class="col-6"><input type="text" class="form-control enter-trigger" id="v_sales" placeholder="ì˜ì—…ì‚¬ì›"></div>
                        <div class="col-6"><input type="text" class="form-control enter-trigger" id="v_phone" placeholder="ì—°ë½ì²˜"></div>
                        <div class="col-12"><input type="text" class="form-control enter-trigger" id="v_office" placeholder="ê°œí†µì‹¤ ì „í™”ë²ˆí˜¸"></div>
                    </div>
                    <button class="btn btn-primary w-100 fw-bold rounded-3" onclick="addVendor()">ë“±ë¡í•˜ê¸°</button>
                </div>
                <div class="glass-card p-0">
                    <div class="p-3 border-bottom bg-light"><h6 class="mb-0 fw-bold">ê±°ë˜ì²˜ ëª©ë¡</h6></div>
                    <div id="vendor_list_ui" class="list-group list-group-flush"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="vendorEditModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">ê±°ë˜ì²˜ ìˆ˜ì •</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="edit_v_old_name">
                    <div class="mb-2"><label class="small text-muted">ê±°ë˜ì²˜ëª…</label><input type="text" class="form-control" id="edit_v_name"></div>
                    <div class="row g-2 mb-2">
                        <div class="col-6"><label class="small text-muted">ì˜ì—…ì‚¬ì›</label><input type="text" class="form-control" id="edit_v_sales"></div>
                        <div class="col-6"><label class="small text-muted">ì—°ë½ì²˜</label><input type="text" class="form-control" id="edit_v_phone"></div>
                    </div>
                    <div class="mb-2"><label class="small text-muted">ê°œí†µì‹¤</label><input type="text" class="form-control" id="edit_v_office"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="submitEditVendor()">ìˆ˜ì • ì™„ë£Œ</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyB_mC39GwfguxtYMm4P4jbszB8d10UhvL9AWZYRGXQxhApSkYP4x-yLiCzmoxhSNDY/exec";
        let currentUser = "";
        let inPendingList = [];

        window.onload = function() {
            const saved = localStorage.getItem('dbphone_user');
            if(saved) { currentUser = JSON.parse(saved).name; showMain(); }
            
            // ê±°ë˜ì²˜ ì—”í„°í‚¤ ì´ë²¤íŠ¸ ì¼ê´„ ë“±ë¡
            document.querySelectorAll('.enter-trigger').forEach(input => {
                input.addEventListener('keydown', function(e) {
                    if(e.key === 'Enter') addVendor();
                });
            });
        };

        function showSection(id) {
            document.querySelectorAll('.section-view').forEach(el => el.classList.remove('active-section'));
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active-section');
            const navBtn = document.querySelector(`a[onclick="showSection('${id}')"]`);
            if(navBtn) navBtn.classList.add('active');
            
            if(id === 'section-in') loadVendors();
            if(id === 'section-vendor') loadVendorsToList();
            const input = document.querySelector(`#${id} input`);
            if(input) input.focus();
        }

        // --- ê±°ë˜ì²˜ ê´€ë¦¬ ---
        function loadVendors() {
            fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "get_vendors" }) })
            .then(r => r.json()).then(d => {
                const sel = document.getElementById('in_supplier');
                sel.innerHTML = "";
                d.list.forEach(v => {
                    const opt = document.createElement('option');
                    opt.value = v.name; opt.innerText = v.name;
                    sel.appendChild(opt);
                });
            });
        }
        function loadVendorsToList() {
            fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "get_vendors" }) })
            .then(r => r.json()).then(d => {
                const div = document.getElementById('vendor_list_ui');
                div.innerHTML = "";
                d.list.forEach(v => {
                    // íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ (JSON.stringify ì´ìš©)
                    const safeV = JSON.stringify(v).replace(/"/g, '&quot;');
                    div.innerHTML += `
                        <div class="list-group-item p-3">
                            <div class="d-flex justify-content-between align-items-start mb-1">
                                <div>
                                    <h6 class="fw-bold mb-0 text-primary">${v.name}</h6>
                                    <div class="small text-muted mt-1">
                                        <i class="bi bi-person me-1"></i>${v.salesName||'-'} 
                                        <i class="bi bi-telephone ms-2 me-1"></i>${v.salesPhone||'-'}
                                    </div>
                                    <div class="small text-muted">
                                        <i class="bi bi-building me-1"></i>ê°œí†µì‹¤: ${v.officePhone||'-'}
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-secondary me-1" onclick="openEditVendor(${safeV})"><i class="bi bi-pencil"></i></button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteVendor('${v.name}')"><i class="bi bi-trash"></i></button>
                                </div>
                            </div>
                        </div>`;
                });
            });
        }
        function addVendor() {
            const data = {
                action: "add_vendor",
                name: document.getElementById('v_name').value,
                salesName: document.getElementById('v_sales').value,
                salesPhone: document.getElementById('v_phone').value,
                officePhone: document.getElementById('v_office').value
            };
            if(!data.name) return alert("ê±°ë˜ì²˜ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
            
            fetch(GAS_URL, { method: "POST", body: JSON.stringify(data) })
            .then(r => r.json()).then(d => {
                alert(d.message);
                document.querySelectorAll('.enter-trigger').forEach(i => i.value = "");
                loadVendorsToList();
            });
        }
        function deleteVendor(name) {
            if(!confirm(`[${name}] ê±°ë˜ì²˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "delete_vendor", name: name }) })
            .then(r => r.json()).then(d => { alert(d.message); loadVendorsToList(); });
        }
        function openEditVendor(v) {
            document.getElementById('edit_v_old_name').value = v.name;
            document.getElementById('edit_v_name').value = v.name;
            document.getElementById('edit_v_sales').value = v.salesName;
            document.getElementById('edit_v_phone').value = v.salesPhone;
            document.getElementById('edit_v_office').value = v.officePhone;
            new bootstrap.Modal(document.getElementById('vendorEditModal')).show();
        }
        function submitEditVendor() {
            const data = {
                action: "update_vendor",
                oldName: document.getElementById('edit_v_old_name').value,
                name: document.getElementById('edit_v_name').value,
                salesName: document.getElementById('edit_v_sales').value,
                salesPhone: document.getElementById('edit_v_phone').value,
                officePhone: document.getElementById('edit_v_office').value
            };
            fetch(GAS_URL, { method: "POST", body: JSON.stringify(data) })
            .then(r => r.json()).then(d => {
                alert(d.message);
                bootstrap.Modal.getInstance(document.getElementById('vendorEditModal')).hide();
                loadVendorsToList();
            });
        }

        // --- ì…ê³  ---
        function toggleInMode() {
            const isBatch = document.getElementById('in_mode_toggle').checked;
            const label = document.getElementById('in_mode_label');
            label.innerText = isBatch ? "ì—°ì† (ëŒ€ê¸°ì—´)" : "ì¼ë°˜ (ì¦‰ì‹œ)";
            label.classList.toggle("text-primary", isBatch);
            document.getElementById('in_batch_area').style.display = isBatch ? 'block' : 'none';
            document.getElementById('in_scan').focus();
        }
        function handleInScan(e) {
            if(e.key !== 'Enter') return;
            const barcode = e.target.value.trim();
            if(!barcode) return;
            const isBatch = document.getElementById('in_mode_toggle').checked;
            const supplier = document.getElementById('in_supplier').value;
            const branch = document.getElementById('in_branch').value;
            e.target.disabled = true;
            fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: isBatch ? "scan_preview" : "register_single", barcode: barcode, supplier: supplier, branch: branch, user: currentUser })})
            .then(r => r.json()).then(d => {
                if(d.status === 'success') {
                    if(isBatch) {
                        inPendingList.push({ ...d.data, supplier: supplier });
                        renderInList();
                        showMsg('in-msg', 'success', `ì¶”ê°€ë¨: ${d.data.model}`);
                    } else showMsg('in-msg', 'success', `âœ… ì™„ë£Œ: ${d.data.model}`);
                } else showMsg('in-msg', 'error', d.message);
            }).finally(() => { e.target.disabled = false; e.target.value = ""; e.target.focus(); });
        }
        function renderInList() {
            const tbody = document.getElementById('in_tbody');
            tbody.innerHTML = "";
            inPendingList.forEach((item, idx) => {
                tbody.innerHTML += `<tr><td class="fw-bold">${item.model}</td><td class="font-monospace text-muted">${item.serial}</td><td><button class="btn btn-sm text-danger p-0" onclick="removeInItem(${idx})"><i class="bi bi-x-circle-fill"></i></button></td></tr>`;
            });
            document.getElementById('in_count').innerText = inPendingList.length;
            document.getElementById('btn_in_submit').disabled = inPendingList.length === 0;
        }
        function removeInItem(idx) { inPendingList.splice(idx, 1); renderInList(); }
        function clearInList() { inPendingList = []; renderInList(); }
        function submitInBatch() {
            if(!confirm(`${inPendingList.length}ëŒ€ë¥¼ ì…ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            const branch = document.getElementById('in_branch').value;
            fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "batch_register", items: inPendingList, branch: branch, user: currentUser })})
            .then(r => r.json()).then(d => {
                if(d.status==='success') { showMsg('in-msg','success',`${d.count}ëŒ€ ì…ê³ ì™„ë£Œ`); clearInList(); }
                else showMsg('in-msg','error',d.message);
            });
        }

        // --- ì´ë™/ë°˜í’ˆ (ì¼ë ¨ë²ˆí˜¸ ì§€ì› placeholder ë³€ê²½ë¨) ---
        function handleMoveScan(e) {
            if(e.key !== 'Enter') return;
            const input = e.target.value.trim(); // barcode or serial
            const toBranch = document.getElementById('move_to_branch').value;
            e.target.disabled = true;
            fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "transfer_stock", input: input, toBranch: toBranch, user: currentUser })})
            .then(r => r.json()).then(d => showMsg('move-msg', d.status==='success'?'success':'error', d.message))
            .finally(() => { e.target.disabled = false; e.target.value = ""; e.target.focus(); });
        }
        function handleOutScan(e) {
            if(e.key !== 'Enter') return;
            const input = e.target.value.trim(); // barcode or serial
            const note = document.getElementById('out_note').value;
            if(!note) { alert("ì‚¬ìœ  í•„ìˆ˜"); return; }
            e.target.disabled = true;
            fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "return_stock", input: input, note: note, user: currentUser })})
            .then(r => r.json()).then(d => showMsg('out-msg', d.status==='success'?'success':'error', d.message))
            .finally(() => { e.target.disabled = false; e.target.value = ""; e.target.focus(); });
        }

        // --- ê¸°íƒ€ ---
        function searchHistory() {
            const key = document.getElementById('hist_keyword').value;
            const div = document.getElementById('hist_result');
            div.innerHTML = `<div class="text-center py-4"><span class="spinner-border text-primary"></span></div>`;
            fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "search_history", keyword: key }) })
            .then(r => r.json()).then(d => {
                if(!d.list.length) { div.innerHTML = `<div class="text-center text-muted py-3">ê²°ê³¼ ì—†ìŒ</div>`; return; }
                let html = "";
                d.list.forEach(h => {
                    let badge = h.type === 'ì…ê³ ' ? 'bg-primary' : (h.type==='ë°˜í’ˆì²˜ë¦¬' ? 'bg-danger' : 'bg-info');
                    html += `<div class="glass-card p-3 mb-2"><div class="d-flex justify-content-between mb-1"><span class="badge ${badge}">${h.type}</span><small class="text-muted">${h.time}</small></div><h6 class="fw-bold mb-1">${h.model}</h6><p class="mb-1 small text-secondary">${h.desc}</p><div class="small text-muted bg-light rounded p-1 d-inline-block"><i class="bi bi-upc"></i> ${h.serial} | ${h.user}</div></div>`;
                });
                div.innerHTML = html;
            });
        }
        function showMsg(id, type, text) {
            const el = document.getElementById(id);
            el.style.display = 'block';
            el.className = `alert py-2 text-center small fw-bold rounded-3 alert-${type==='success'?'success':'danger'}`;
            el.innerHTML = type==='success' ? `<i class="bi bi-check-circle-fill me-1"></i> ${text}` : `<i class="bi bi-exclamation-triangle-fill me-1"></i> ${text}`;
            setTimeout(() => el.style.display='none', 2000);
        }
        function handleCredentialResponse(r) {
            fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "login", token: r.credential }) })
            .then(res => res.json()).then(d => {
                if(d.status==='success') { localStorage.setItem('dbphone_user', JSON.stringify({name:d.name,email:d.user})); currentUser=d.name; document.getElementById('login-view').style.display='none'; document.getElementById('main-view').style.display='block'; loadVendors(); }
                else document.getElementById('login-msg').innerText = d.message;
            });
        }
        function logout() { localStorage.removeItem('dbphone_user'); location.reload(); }
    </script>
</body>
</html>
